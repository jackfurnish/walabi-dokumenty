<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protokół Odbioru Montażu Mebli - WALABI</title>
    <!-- Google Fonts - Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* ===== QUIET LUXURY 2026 DESIGN SYSTEM ===== */
        :root {
            --color-primary: #2D2E2E;
            --color-secondary: #757575;
            --color-border: #E0E0E0;
            --color-background: #FAFAFA;
            --color-white: #FFFFFF;
            --color-highlight: #F7F5F0;
            --color-accent: #2D2E2E;

            --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;

            /* Typography - Labels */
            --font-size-label: 7pt;
            --font-weight-label: 500;
            --color-label: #757575;
            --letter-spacing-label: 0.08em;

            /* Typography - Data */
            --font-size-data: 9pt;
            --font-weight-data: 600;
            --color-data: #2D2E2E;

            /* Typography - Other */
            --font-size-xs: 6.5pt;
            --font-size-sm: 8pt;
            --font-size-base: 9pt;
            --font-size-lg: 10pt;
            --font-size-xl: 12pt;
            --font-size-title: 14pt;

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 6px;
            --spacing-md: 10px;
            --spacing-lg: 14px;
            --spacing-xl: 18px;

            --line-height: 1.3;
        }

        /* Flatpickr customization */
        .flatpickr-calendar {
            font-family: var(--font-primary) !important;
            font-size: 12px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,.15) !important;
            border: 1px solid var(--color-border) !important;
        }
        .flatpickr-day.selected, .flatpickr-day.selected:hover {
            background: var(--color-primary) !important;
            border-color: var(--color-primary) !important;
        }
        .flatpickr-day:hover {
            background: var(--color-highlight) !important;
        }

        /* ===== RESET & BASE ===== */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            line-height: var(--line-height);
            background: #E8E8E8;
            color: var(--color-primary);
            font-weight: 400;
        }

        /* ===== LAYOUT ===== */
        .app-wrapper {
            display: flex;
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 24px;
            align-self: flex-start;
        }

        .sidebar-card {
            background: var(--color-white);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,.08);
            border: 1px solid var(--color-border);
        }

        .sidebar-card h3 {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar .logo-area {
            text-align: center;
            padding: 12px 0;
        }

        .sidebar .logo-area img {
            max-width: 100px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 10px 14px;
            margin-bottom: 6px;
            font-size: 11px;
            font-weight: 600;
            font-family: var(--font-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            transition: all .2s ease;
            letter-spacing: 0.02em;
        }

        .btn:active { transform: scale(.98); }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-white);
        }
        .btn-primary:hover { background: #1a1a1a; }

        .btn-secondary {
            background: var(--color-background);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
        }
        .btn-secondary:hover { background: var(--color-highlight); }

        .btn-danger {
            background: var(--color-white);
            color: #B71C1C;
            border: 1px solid var(--color-border);
        }
        .btn-danger:hover { background: #FFF5F5; }

        /* Historia */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            font-size: 11px;
        }

        .history-item {
            padding: 8px 10px;
            border-bottom: 1px solid var(--color-border);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background .2s;
        }

        .history-item:hover { background: var(--color-highlight); }

        .history-item .hi-number {
            font-weight: 600;
            color: var(--color-primary);
        }
        .history-item .hi-client {
            color: var(--color-secondary);
            font-size: 10px;
        }
        .history-item .hi-delete {
            color: #B71C1C;
            cursor: pointer;
            font-size: 14px;
            padding: 0 4px;
            border: none;
            background: none;
            opacity: 0.6;
            transition: opacity .2s;
        }
        .history-item .hi-delete:hover { opacity: 1; }

        .history-empty {
            color: var(--color-secondary);
            font-style: italic;
            padding: 12px;
            text-align: center;
            font-size: 11px;
        }

        /* ===== DOKUMENT ===== */
        .page-container {
            flex: 1;
            min-width: 0;
        }

        .document {
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 15mm;
            background: var(--color-white);
            box-shadow: 0 2px 12px rgba(0,0,0,.1);
            position: relative;
        }

        /* --- Nagłówek z logo --- */
        .doc-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--color-border);
        }

        .doc-header .logo img {
            height: 45px;
        }

        .doc-header .company-info {
            text-align: right;
        }

        .doc-header .company-info .name {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--color-primary);
            letter-spacing: 0.02em;
        }

        .doc-header .company-info .tagline {
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
            margin-top: 2px;
            letter-spacing: 0.03em;
        }

        .doc-header .company-info .contact {
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
            margin-top: 4px;
        }

        /* --- Tytuł dokumentu --- */
        .doc-title {
            text-align: center;
            font-size: var(--font-size-title);
            font-weight: 700;
            margin: 16px 0;
            padding: 14px 0;
            border-top: 2px solid var(--color-primary);
            border-bottom: 2px solid var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
        }

        /* --- Sekcje --- */
        .doc-section {
            margin-bottom: 14px;
        }

        .doc-section-title {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--color-border);
        }

        .doc-hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 14px 0;
        }

        /* --- Meta dokumentu --- */
        .doc-meta {
            background: var(--color-background);
            padding: 12px 14px;
            border: 1px solid var(--color-border);
            margin-bottom: 14px;
        }

        .doc-meta-row {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
            align-items: baseline;
        }

        .doc-meta-row:last-child { margin-bottom: 0; }

        .doc-meta-row .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            min-width: 160px;
        }

        /* --- Inputy w dokumencie --- */
        .doc-field {
            border: none;
            border-bottom: 1px solid var(--color-border);
            padding: 2px 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            transition: all .2s;
        }

        .doc-field:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
            background: var(--color-highlight);
        }

        .doc-field::placeholder {
            color: #BDBDBD;
            font-weight: 400;
        }

        .w60  { width: 60px; }
        .w80  { width: 80px; }
        .w100 { width: 100px; }
        .w120 { width: 120px; }
        .w150 { width: 150px; }
        .w200 { width: 200px; }
        .w250 { width: 250px; }
        .w300 { width: 300px; }
        .w350 { width: 350px; }
        .w-full { width: 100%; }

        /* --- Rows --- */
        .doc-row {
            display: flex;
            flex-wrap: wrap;
            gap: 4px 15px;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .doc-row .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
        }

        /* --- Dane inwestycji --- */
        .investment-info {
            background: var(--color-highlight);
            padding: 12px 14px;
            border: 1px solid var(--color-border);
            margin-bottom: 14px;
        }

        /* --- Zakres odbioru --- */
        .scope-box {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            padding: 12px 14px;
            margin-bottom: 14px;
            font-size: var(--font-size-sm);
            line-height: 1.6;
            color: var(--color-primary);
        }

        .scope-box p {
            margin-bottom: 8px;
        }

        .scope-box ul {
            margin: 8px 0 8px 20px;
        }

        .scope-box li {
            margin-bottom: 4px;
        }

        /* --- Status odbioru --- */
        .status-box {
            border: 1px solid var(--color-border);
            padding: 14px;
            margin-bottom: 14px;
        }

        .status-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            cursor: pointer;
            transition: background .2s;
            border: 1px solid transparent;
        }

        .status-option:hover {
            background: var(--color-background);
        }

        .status-option:last-child {
            margin-bottom: 0;
        }

        .status-option.selected {
            background: var(--color-highlight);
            border-color: var(--color-border);
        }

        .status-option input[type="radio"] {
            width: 16px;
            height: 16px;
            margin-top: 2px;
            accent-color: var(--color-primary);
            cursor: pointer;
        }

        .status-option-content {
            flex: 1;
        }

        .status-option-title {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .status-option-desc {
            font-size: var(--font-size-sm);
            color: var(--color-secondary);
        }

        .remarks-area {
            margin-top: 10px;
            display: none;
        }

        .remarks-area.visible {
            display: block;
        }

        .remarks-area label {
            display: block;
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 4px;
        }

        .remarks-area textarea {
            width: 100%;
            height: 70px;
            border: 1px solid var(--color-border);
            padding: 8px;
            font-size: var(--font-size-data);
            font-family: var(--font-primary);
            resize: vertical;
        }

        .remarks-area textarea:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .deadline-row {
            margin-top: 10px;
            font-size: var(--font-size-base);
        }

        /* --- Klauzula --- */
        .clause-box {
            background: var(--color-background);
            border-left: 2px solid var(--color-primary);
            padding: 10px 14px;
            margin-bottom: 14px;
            font-size: var(--font-size-sm);
            line-height: 1.5;
            color: var(--color-secondary);
        }

        .clause-box strong {
            color: var(--color-primary);
        }

        /* --- Podpisy --- */
        .signatures-section {
            margin-top: 20px;
        }

        .signatures-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .signature-box {
            border: 1px solid var(--color-border);
            padding: 14px;
        }

        .signature-box h4 {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border);
        }

        .signature-row {
            margin-bottom: 10px;
        }

        .signature-row label {
            display: block;
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 4px;
        }

        .signature-line {
            border-bottom: 1px solid var(--color-border);
            min-height: 24px;
            margin-top: 4px;
        }

        .signature-row input {
            border: none;
            border-bottom: 1px solid var(--color-border);
            width: 100%;
            padding: 2px 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            color: var(--color-data);
        }

        .signature-row input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
            background: var(--color-highlight);
        }

        /* --- Stopka --- */
        .doc-footer {
            margin-top: 20px;
            font-size: var(--font-size-xs);
            color: var(--color-primary);
            text-align: center;
            border-top: 1px solid var(--color-border);
            padding-top: 8px;
            letter-spacing: 0.03em;
        }

        /* ===== STRONA 2 - UWAGI ===== */
        .remarks-page {
            display: none;
            margin-top: 30px;
            page-break-before: always;
        }

        .remarks-page.visible {
            display: block;
        }

        .remarks-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-sm);
        }

        .remarks-table th {
            background: var(--color-primary);
            color: var(--color-white);
            padding: 8px 10px;
            font-weight: 600;
            font-size: var(--font-size-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            text-align: left;
        }

        .remarks-table td {
            border: 1px solid var(--color-border);
            padding: 6px 8px;
            height: 30px;
            vertical-align: middle;
        }

        .remarks-table td:first-child {
            text-align: center;
            font-weight: 600;
            background: var(--color-background);
            color: var(--color-primary);
        }

        .remarks-table input {
            width: 100%;
            border: none;
            padding: 2px 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
        }

        .remarks-table input:focus {
            outline: none;
            background: var(--color-highlight);
        }

        /* ===== DRUK ===== */
        @media print {
            html, body {
                background: var(--color-white);
                margin: 0;
                padding: 0;
            }

            .sidebar, .no-print { display: none !important; }

            .app-wrapper {
                padding: 0;
                margin: 0;
            }

            .document {
                box-shadow: none;
                padding: 8mm 12mm;
                width: 210mm;
                min-height: 296mm;
            }

            .doc-field, .signature-row input, .remarks-area textarea, .remarks-table input {
                border-color: transparent !important;
                background: transparent !important;
            }

            .doc-section-title,
            .investment-info,
            .scope-box,
            .status-box,
            .clause-box,
            .status-option.selected,
            .remarks-table th,
            .remarks-table td:first-child {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            input[type="radio"] {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            .remarks-page {
                page-break-before: always;
            }

            .remarks-page.visible {
                display: block !important;
            }

            @page {
                size: A4;
                margin: 5mm;
            }
        }

        /* ===== RESPONSIVE ===== */
        @media screen and (max-width: 900px) {
            .app-wrapper {
                flex-direction: column;
                padding: 12px;
            }
            .sidebar {
                width: 100%;
                position: static;
            }
            .document {
                width: 100%;
                min-height: auto;
                padding: 16px;
            }
            .signatures-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: 6px;
            font-size: 12px;
            font-family: var(--font-primary);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all .3s ease;
            z-index: 999;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { background: #2E7D32; }
        .toast.error { background: #C62828; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <!-- ===== PANEL BOCZNY ===== -->
    <aside class="sidebar no-print">
        <div class="sidebar-card logo-area">
            <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:22px;font-weight:700;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI<div style=&quot;font-size:8px;color:#757575;font-weight:400;margin-top:2px&quot;>Sp. z o.o. Sp.k.</div></div>'">
        </div>

        <div class="sidebar-card">
            <h3>Akcje</h3>
            <a href="../index.html" class="btn btn-secondary" style="text-decoration:none;margin-bottom:12px;">← Strona główna</a>
            <button class="btn btn-primary" onclick="printDoc()">Drukuj / Zapisz PDF</button>
            <button class="btn btn-secondary" onclick="saveDocument()">Zapisz dokument</button>
            <button class="btn btn-secondary" onclick="newDocument()">Nowy dokument</button>
            <button class="btn btn-danger" onclick="clearForm()">Wyczyść formularz</button>
        </div>

        <div class="sidebar-card" id="remarksControls" style="display:none;">
            <h3>Uwagi (strona 2)</h3>
            <div style="display:flex;gap:6px;">
                <button class="btn btn-secondary" onclick="addRemarkRow()" style="flex:1;text-align:center;">+ Dodaj</button>
                <button class="btn btn-secondary" onclick="removeRemarkRow()" style="flex:1;text-align:center;">- Usuń</button>
            </div>
        </div>

        <div class="sidebar-card">
            <h3>Historia dokumentów</h3>
            <div id="historyList" class="history-list">
                <div class="history-empty">Brak zapisanych dokumentów</div>
            </div>
        </div>
    </aside>

    <!-- ===== DOKUMENT ===== -->
    <main class="page-container">
        <div class="document" id="document">

            <!-- Nagłówek -->
            <div class="doc-header">
                <div class="logo">
                    <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:20px;font-weight:700;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI</div>'">
                </div>
                <div class="company-info">
                    <div class="name">WALABI sp. z o.o. sp.k.</div>
                    <div class="tagline">Produkcja · Dostawa · Montaż mebli na zamówienie</div>
                    <div class="contact">poczta@walabi.pl · www.walabi.pl</div>
                </div>
            </div>

            <!-- Tytuł -->
            <div class="doc-title">Protokół Odbioru Montażu Mebli</div>

            <!-- Meta dokumentu -->
            <div class="doc-meta">
                <div class="doc-meta-row">
                    <span class="label">Nr projektu</span>
                    <input type="text" class="doc-field w150" id="projectNumber" placeholder="">
                </div>
                <div class="doc-meta-row">
                    <span class="label">Data zakończenia montażu</span>
                    <input type="text" class="doc-field w100" id="completionDate" placeholder="">
                </div>
            </div>

            <hr class="doc-hr">

            <!-- Dane inwestycji -->
            <div class="doc-section">
                <div class="doc-section-title">Dane Inwestycji</div>
                <div class="investment-info">
                    <div class="doc-row">
                        <span class="label">Inwestor / Obiekt</span>
                        <input type="text" class="doc-field w350" id="investorName" placeholder="">
                    </div>
                    <div class="doc-row">
                        <span class="label">Adres realizacji</span>
                        <input type="text" class="doc-field w350" id="realizationAddress" placeholder="">
                    </div>
                </div>
            </div>

            <!-- Zakres odbioru -->
            <div class="doc-section">
                <div class="doc-section-title">Zakres Odbioru</div>
                <div class="scope-box">
                    <p>Niniejszym potwierdza się wykonanie montażu mebli zgodnie z:</p>
                    <ul>
                        <li>zatwierdzonym projektem / zamówieniem,</li>
                        <li>uzgodnionym zakresem realizacji,</li>
                        <li>standardami wykonawczymi WALABI.</li>
                    </ul>
                    <p>Zakres obejmuje w szczególności montaż, ustawienie, wypoziomowanie
                    oraz podstawową regulację okuć.</p>
                </div>
            </div>

            <!-- Status odbioru -->
            <div class="doc-section">
                <div class="doc-section-title">Status Odbioru</div>
                <div class="status-box">
                    <label class="status-option" id="statusOkOption">
                        <input type="radio" name="status" id="statusOk" value="ok" checked>
                        <div class="status-option-content">
                            <div class="status-option-title">Odbiór bez uwag</div>
                            <div class="status-option-desc">Prace wykonane prawidłowo.</div>
                        </div>
                    </label>

                    <label class="status-option" id="statusRemarksOption">
                        <input type="radio" name="status" id="statusRemarks" value="remarks">
                        <div class="status-option-content">
                            <div class="status-option-title">Odbiór z uwagami</div>
                            <div class="status-option-desc">Stwierdzone uwagi do usunięcia - patrz strona 2.</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Klauzula -->
            <div class="clause-box">
                <strong>KLAUZULA ODBIOROWA:</strong> Podpisanie niniejszego protokołu potwierdza wykonanie usługi montażu mebli.
                Odbiór nie obejmuje regulacji wynikających z normalnej eksploatacji obiektu.
            </div>

            <!-- Podpisy -->
            <div class="signatures-section">
                <div class="doc-section-title">Podpisy</div>
                <div class="signatures-grid">
                    <div class="signature-box">
                        <h4>Odbiór po stronie Inwestora</h4>
                        <div class="signature-row">
                            <label>Imię i nazwisko (czytelnie)</label>
                            <input type="text" id="investorSignName" placeholder="">
                        </div>
                        <div class="signature-row">
                            <label>Stanowisko</label>
                            <input type="text" id="investorSignPosition" placeholder="">
                        </div>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                        <div class="signature-row">
                            <label>Data</label>
                            <input type="text" id="investorSignDate" placeholder="">
                        </div>
                    </div>

                    <div class="signature-box">
                        <h4>Przedstawiciel WALABI</h4>
                        <div class="signature-row">
                            <label>Imię i nazwisko</label>
                            <input type="text" id="walabiSignName" placeholder="">
                        </div>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stopka -->
            <div class="doc-footer">
                WALABI Sp. z o.o. Sp.k. · ul. Kosynierów Kościuszkowskich 13/4 · 87-100 Toruń · NIP: 8792700696
            </div>
        </div>

        <!-- ===== STRONA 2 - UWAGI ===== -->
        <div class="document remarks-page" id="remarksPage">
            <!-- Nagłówek strony 2 -->
            <div class="doc-header">
                <div class="logo">
                    <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:20px;font-weight:700;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI</div>'">
                </div>
                <div class="company-info">
                    <div class="name">WALABI sp. z o.o. sp.k.</div>
                    <div class="tagline">Produkcja · Dostawa · Montaż mebli na zamówienie</div>
                    <div class="contact">poczta@walabi.pl · www.walabi.pl</div>
                </div>
            </div>

            <div class="doc-title" style="font-size:12pt;">Protokół Odbioru Montażu Mebli - ZAŁĄCZNIK: UWAGI</div>

            <!-- Odniesienie do dokumentu głównego -->
            <div class="doc-meta">
                <div class="doc-meta-row">
                    <span class="label">Nr projektu</span>
                    <span id="remarksProjectNumber" style="font-size:var(--font-size-data);font-weight:var(--font-weight-data);color:var(--color-data);">-</span>
                </div>
                <div class="doc-meta-row">
                    <span class="label">Inwestor / Obiekt</span>
                    <span id="remarksInvestorName" style="font-size:var(--font-size-data);font-weight:var(--font-weight-data);color:var(--color-data);">-</span>
                </div>
            </div>

            <hr class="doc-hr">

            <!-- Lista uwag -->
            <div class="doc-section">
                <div class="doc-section-title">Stwierdzone Uwagi Do Usunięcia</div>
                <div class="remarks-list-container">
                    <table class="remarks-table" id="remarksTable">
                        <thead>
                            <tr>
                                <th style="width:30px;">Lp.</th>
                                <th>Opis uwagi / usterki</th>
                                <th style="width:100px;">Pomieszczenie</th>
                            </tr>
                        </thead>
                        <tbody id="remarksTableBody">
                            <!-- Generowane dynamicznie -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Termin usunięcia -->
            <div class="doc-section" style="margin-top:15px;">
                <div class="doc-row">
                    <span class="label">Termin usunięcia uwag</span>
                    <input type="text" class="doc-field w150" id="remarksDeadline" placeholder="">
                </div>
            </div>

            <!-- Podpisy na stronie uwag -->
            <div class="signatures-section" style="margin-top:20px;">
                <div class="doc-section-title">Podpisy potwierdzające listę uwag</div>
                <div class="signatures-grid">
                    <div class="signature-box">
                        <h4>Inwestor</h4>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                    <div class="signature-box">
                        <h4>Przedstawiciel WALABI</h4>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stopka strony 2 -->
            <div class="doc-footer">
                Strona 2/2 · WALABI Sp. z o.o. Sp.k. · NIP: 8792700696
            </div>
        </div>
    </main>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
(function() {
    'use strict';

    const STORAGE_KEY = 'walabi_assembly_protocols';
    const CURRENT_KEY = 'walabi_assembly_current';
    let remarkRowCount = 10;

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded', function() {
        setDefaultDate();
        setNextProjectNumber();
        renderHistory();
        initStatusToggle();
        buildRemarkRows(10);
    });

    // ===== STATUS TOGGLE =====
    function initStatusToggle() {
        const statusOk = document.getElementById('statusOk');
        const statusRemarks = document.getElementById('statusRemarks');
        const remarksPage = document.getElementById('remarksPage');
        const remarksControls = document.getElementById('remarksControls');
        const statusOkOption = document.getElementById('statusOkOption');
        const statusRemarksOption = document.getElementById('statusRemarksOption');

        function updateStatus() {
            if (statusRemarks.checked) {
                remarksPage.classList.add('visible');
                remarksControls.style.display = 'block';
                statusRemarksOption.classList.add('selected');
                statusOkOption.classList.remove('selected');
                syncRemarksPageData();
            } else {
                remarksPage.classList.remove('visible');
                remarksControls.style.display = 'none';
                statusOkOption.classList.add('selected');
                statusRemarksOption.classList.remove('selected');
            }
        }

        statusOk.addEventListener('change', updateStatus);
        statusRemarks.addEventListener('change', updateStatus);

        // Synchronizuj dane do strony uwag przy zmianie
        document.getElementById('projectNumber').addEventListener('input', syncRemarksPageData);
        document.getElementById('investorName').addEventListener('input', syncRemarksPageData);

        updateStatus();
    }

    // ===== SYNCHRONIZACJA DANYCH NA STRONĘ 2 =====
    function syncRemarksPageData() {
        document.getElementById('remarksProjectNumber').textContent =
            document.getElementById('projectNumber').value || '-';
        document.getElementById('remarksInvestorName').textContent =
            document.getElementById('investorName').value || '-';
    }

    // ===== WIERSZE UWAG =====
    function buildRemarkRows(count) {
        const tbody = document.getElementById('remarksTableBody');
        tbody.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            tbody.appendChild(createRemarkRow(i));
        }
        remarkRowCount = count;
    }

    function createRemarkRow(num) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${num}</td>
            <td><input type="text" id="remark${num}_desc" placeholder=""></td>
            <td><input type="text" id="remark${num}_room" placeholder=""></td>`;
        return tr;
    }

    window.addRemarkRow = function() {
        remarkRowCount++;
        const tbody = document.getElementById('remarksTableBody');
        tbody.appendChild(createRemarkRow(remarkRowCount));
        toast('Dodano wiersz ' + remarkRowCount);
    };

    window.removeRemarkRow = function() {
        if (remarkRowCount <= 1) return;
        const tbody = document.getElementById('remarksTableBody');
        tbody.removeChild(tbody.lastElementChild);
        remarkRowCount--;
        toast('Usunięto wiersz');
    };

    // ===== DATA I NUMER =====
    function setDefaultDate() {
        const d = new Date();
        const str = String(d.getDate()).padStart(2,'0') + '.' + String(d.getMonth()+1).padStart(2,'0') + '.' + d.getFullYear();
        document.getElementById('completionDate').value = str;
    }

    function setNextProjectNumber() {
        const docs = loadAllDocs();
        const year = new Date().getFullYear();
        const count = docs.length + 1;
        document.getElementById('projectNumber').value = 'PM-' + String(count).padStart(3, '0') + '/' + year;
    }

    // ===== SERIALIZACJA =====
    function collectFormData() {
        const data = { fields: {}, remarkRowCount: remarkRowCount };

        document.querySelectorAll('.document input, .document textarea').forEach(el => {
            if (!el.id) return;
            if (el.type === 'radio') {
                if (el.checked) data.fields[el.name] = el.value;
            } else {
                data.fields[el.id] = el.value;
            }
        });

        return data;
    }

    function restoreFormData(data) {
        if (data.remarkRowCount) {
            buildRemarkRows(data.remarkRowCount);
        }

        Object.keys(data.fields).forEach(key => {
            if (key === 'status') {
                const radio = document.querySelector(`input[name="status"][value="${data.fields[key]}"]`);
                if (radio) {
                    radio.checked = true;
                    radio.dispatchEvent(new Event('change'));
                }
            } else {
                const el = document.getElementById(key);
                if (el) el.value = data.fields[key];
            }
        });

        syncRemarksPageData();
    }

    // ===== STORAGE =====
    function loadAllDocs() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        } catch { return []; }
    }

    function saveAllDocs(docs) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(docs));
    }

    window.saveDocument = function() {
        const data = collectFormData();
        const projectNr = document.getElementById('projectNumber').value || '???';
        const investor = document.getElementById('investorName').value || 'Brak inwestora';
        const date = document.getElementById('completionDate').value || '';

        const doc = {
            id: Date.now(),
            number: projectNr,
            investor: investor,
            date: date,
            data: data
        };

        const docs = loadAllDocs();
        const currentId = parseInt(localStorage.getItem(CURRENT_KEY));
        const existingIdx = docs.findIndex(d => d.id === currentId);

        if (existingIdx >= 0) {
            docs[existingIdx] = { ...docs[existingIdx], number: doc.number, investor: doc.investor, date: doc.date, data: doc.data };
        } else {
            docs.push(doc);
            localStorage.setItem(CURRENT_KEY, doc.id);
        }

        saveAllDocs(docs);
        renderHistory();
        toast('Dokument zapisany', 'success');
    };

    window.loadDocument = function(id) {
        const docs = loadAllDocs();
        const doc = docs.find(d => d.id === id);
        if (!doc) return;
        restoreFormData(doc.data);
        localStorage.setItem(CURRENT_KEY, id);
        toast('Wczytano: ' + doc.number);
    };

    window.deleteDocument = function(id, e) {
        e.stopPropagation();
        if (!confirm('Usunąć ten dokument z historii?')) return;
        let docs = loadAllDocs();
        docs = docs.filter(d => d.id !== id);
        saveAllDocs(docs);
        renderHistory();
        toast('Dokument usunięty');
    };

    // ===== HISTORIA =====
    function renderHistory() {
        const docs = loadAllDocs();
        const container = document.getElementById('historyList');

        if (!docs.length) {
            container.innerHTML = '<div class="history-empty">Brak zapisanych dokumentów</div>';
            return;
        }

        container.innerHTML = docs.map(doc => `
            <div class="history-item" onclick="loadDocument(${doc.id})">
                <div>
                    <div class="hi-number">${doc.number}</div>
                    <div class="hi-client">${doc.investor} | ${doc.date}</div>
                </div>
                <button class="hi-delete" onclick="deleteDocument(${doc.id}, event)" title="Usuń">&times;</button>
            </div>
        `).reverse().join('');
    }

    // ===== AKCJE =====
    window.newDocument = function() {
        if (!confirm('Rozpocząć nowy dokument? Niezapisane dane zostaną utracone.')) return;

        buildRemarkRows(10);

        document.querySelectorAll('.document input, .document textarea').forEach(el => {
            if (el.type === 'radio') {
                el.checked = el.value === 'ok';
            } else {
                el.value = '';
            }
        });

        document.getElementById('statusOk').dispatchEvent(new Event('change'));
        localStorage.removeItem(CURRENT_KEY);
        setDefaultDate();
        setNextProjectNumber();
        syncRemarksPageData();
        toast('Nowy dokument');
    };

    window.clearForm = function() {
        if (!confirm('Wyczyścić wszystkie pola formularza?')) return;

        buildRemarkRows(10);

        document.querySelectorAll('.document input, .document textarea').forEach(el => {
            if (el.type === 'radio') {
                el.checked = el.value === 'ok';
            } else {
                el.value = '';
            }
        });

        document.getElementById('statusOk').dispatchEvent(new Event('change'));
        setDefaultDate();
        syncRemarksPageData();
        toast('Formularz wyczyszczony');
    };

    window.printDoc = function() {
        window.print();
    };

    // ===== TOAST =====
    function toast(msg, type) {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.className = 'toast show ' + (type || '');
        clearTimeout(el._timer);
        el._timer = setTimeout(() => { el.className = 'toast'; }, 2500);
    }

})();
</script>
<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fpConfig = {
            locale: 'pl',
            dateFormat: 'd.m.Y',
            allowInput: true,
            disableMobile: false
        };

        flatpickr('#completionDate', fpConfig);
        flatpickr('#remarksDeadline', fpConfig);
        flatpickr('#investorSignDate', fpConfig);
    });
</script>
</body>
</html>
