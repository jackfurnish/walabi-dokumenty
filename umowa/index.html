<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umowa - WALABI</title>
    <!-- Google Fonts: Plus Jakarta Sans (full charset with Polish diacritics) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&subset=latin-ext&display=swap" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* ===== QUIET LUXURY 2026 - TYPOGRAPHY HIERARCHY ===== */
        :root {
            /* Colors */
            --color-primary: #2D2E2E;      /* Deep Anthracite - for DATA */
            --color-secondary: #757575;     /* Warm Grey - for LABELS */
            --color-accent: #B8860B;
            --color-border: #E0E0E0;
            --color-background: #FAFAFA;
            --color-white: #FFFFFF;
            --color-highlight: #F7F5F0;

            /* Typography */
            --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;

            /* LABELS: 7pt, Regular, Warm Grey, Uppercase, 0.08em tracking */
            --font-size-label: 7pt;
            --font-weight-label: 400;
            --color-label: #757575;

            /* DATA: 9pt, Semi-bold, Deep Anthracite, Sentence case */
            --font-size-data: 9pt;
            --font-weight-data: 600;
            --color-data: #2D2E2E;

            /* Other sizes */
            --font-size-xs: 6.5pt;
            --font-size-base: 8.5pt;
            --font-size-lg: 10pt;
            --font-size-xl: 12pt;

            /* Spacing */
            --spacing-label-data: 2pt;
            --spacing-xs: 3px;
            --spacing-sm: 6px;
            --spacing-md: 10px;
            --spacing-lg: 14px;
            --spacing-xl: 18px;

            --line-height: 1.4;
            --letter-spacing: 0.08em;
            --letter-spacing-label: 0.08em;
            --border-radius: 2px;
        }

        /* ===== RESET & BASE ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            line-height: var(--line-height);
            background: #E8E8E8;
            color: var(--color-primary);
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== FLATPICKR CUSTOMIZATION ===== */
        .flatpickr-calendar {
            font-family: var(--font-primary) !important;
            font-size: 11px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,.12) !important;
            border: 1px solid var(--color-border) !important;
            border-radius: 4px !important;
        }
        .flatpickr-day.selected, .flatpickr-day.selected:hover {
            background: var(--color-primary) !important;
            border-color: var(--color-primary) !important;
        }
        .flatpickr-day:hover {
            background: var(--color-highlight) !important;
        }

        /* ===== LAYOUT ===== */
        .app-wrapper {
            display: flex;
            gap: 20px;
            max-width: 1150px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 240px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            align-self: flex-start;
        }

        .sidebar-card {
            background: var(--color-white);
            border-radius: 6px;
            padding: 14px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,.06);
            border: 1px solid var(--color-border);
        }

        .sidebar-card h3 {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            margin-bottom: 10px;
            color: var(--color-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar .logo-area {
            text-align: center;
            padding: 12px 0;
        }

        .sidebar .logo-area img {
            max-width: 110px;
            opacity: 0.9;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 6px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: all .2s ease;
            letter-spacing: 0.02em;
        }

        .btn:active { transform: scale(.98); }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-white);
        }
        .btn-primary:hover { background: #1a1a1a; }

        .btn-secondary {
            background: var(--color-background);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
        }
        .btn-secondary:hover { background: var(--color-highlight); }

        .btn-danger {
            background: var(--color-white);
            color: #9A3412;
            border: 1px solid var(--color-border);
        }
        .btn-danger:hover { background: #FEF2F2; }

        /* Historia */
        .history-list {
            max-height: 180px;
            overflow-y: auto;
        }

        .history-item {
            padding: 8px 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            transition: background .15s;
        }

        .history-item:last-child { border-bottom: none; }
        .history-item:hover { background: var(--color-highlight); }

        .history-item .hi-number {
            font-weight: var(--font-weight-data);
            font-size: var(--font-size-data);
            color: var(--color-data);
        }
        .history-item .hi-client {
            color: var(--color-label);
            font-size: var(--font-size-label);
            margin-top: 1px;
        }
        .history-item .hi-delete {
            color: var(--color-secondary);
            cursor: pointer;
            font-size: 14px;
            padding: 0 3px;
            border: none;
            background: none;
            opacity: 0.5;
            transition: opacity .15s;
        }
        .history-item .hi-delete:hover { opacity: 1; color: #9A3412; }

        .history-empty {
            color: var(--color-secondary);
            font-style: italic;
            padding: 12px;
            text-align: center;
            font-size: var(--font-size-label);
        }

        /* ===== DOCUMENT ===== */
        .page-container {
            flex: 1;
            min-width: 0;
        }

        .document {
            width: 210mm;
            min-height: 297mm;
            padding: 18mm 14mm;
            background: var(--color-white);
            box-shadow: 0 4px 24px rgba(0,0,0,.08);
            position: relative;
        }

        /* --- HEADER --- */
        .doc-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .doc-header .logo img {
            height: 80px;
            opacity: 0.95;
        }

        /* --- DOCUMENT TITLE --- */
        .doc-title {
            text-align: center;
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md) 0;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--color-primary);
            border-top: 0.5pt solid var(--color-primary);
            border-bottom: 0.5pt solid var(--color-primary);
        }

        .doc-title input {
            border: none;
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-xl);
            font-weight: 700;
            font-family: var(--font-primary);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            background: transparent;
            color: var(--color-primary);
        }

        .doc-title input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
        }

        .doc-number {
            text-align: center;
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--color-primary);
        }

        .doc-number input {
            border: none;
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-lg);
            font-weight: 600;
            font-family: var(--font-primary);
            text-align: center;
            width: 120px;
            color: var(--color-data);
            background: transparent;
        }

        .doc-number input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
        }

        /* --- CONTRACT INTRO --- */
        .contract-intro {
            font-size: var(--font-size-base);
            line-height: 1.5;
            margin-bottom: var(--spacing-lg);
        }

        .contract-intro p {
            margin-bottom: var(--spacing-sm);
        }

        .contract-intro .date-place {
            margin-bottom: var(--spacing-md);
        }

        .contract-intro .date-place input {
            border: none;
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            width: 120px;
            text-align: center;
        }

        .contract-intro .date-place input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
        }

        /* --- PARTY SECTION --- */
        .party-section {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
            background: var(--color-highlight);
            border-radius: var(--border-radius);
        }

        .party-title {
            font-size: var(--font-size-label);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing);
            color: var(--color-primary);
            margin-bottom: var(--spacing-xs);
        }

        .party-details {
            font-size: var(--font-size-base);
            line-height: 1.5;
        }

        .party-details .field-row {
            margin-bottom: 2px;
        }

        .party-details input, .party-details textarea {
            border: none;
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            text-align: center;
        }

        .party-details input:focus, .party-details textarea:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
        }

        .party-details .w-full { width: 100%; }
        .party-details .w-220 { width: 220px; }
        .party-details .w-200 { width: 200px; }
        .party-details .w-150 { width: 150px; }
        .party-details .w-120 { width: 120px; }
        .party-details .w-100 { width: 100px; }

        /* --- PARAGRAPH SECTION --- */
        .paragraph-section {
            margin-bottom: var(--spacing-md);
        }

        .paragraph-title {
            font-size: var(--font-size-data);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-xs);
            border-bottom: 0.5pt solid var(--color-border);
        }

        .paragraph-content {
            font-size: var(--font-size-base);
            line-height: 1.5;
        }

        .paragraph-content ol {
            margin-left: 16px;
            margin-bottom: var(--spacing-sm);
        }

        .paragraph-content ol li {
            margin-bottom: 4px;
        }

        .paragraph-content ol ol {
            margin-top: 4px;
            list-style-type: decimal;
        }

        .paragraph-content input {
            border: none;
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            text-align: center;
        }

        .paragraph-content input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
        }

        .paragraph-content .w-40 { width: 40px; }
        .paragraph-content .w-60 { width: 60px; }
        .paragraph-content .w-80 { width: 80px; }
        .paragraph-content .w-100 { width: 100px; }
        .paragraph-content .w-120 { width: 120px; }
        .paragraph-content .w-150 { width: 150px; }
        .paragraph-content .w-200 { width: 200px; }
        .paragraph-content .w-220 { width: 220px; }
        .paragraph-content .w-full { width: 100%; }
        .paragraph-content .w-auto {
            width: auto;
            min-width: 180px;
            max-width: 100%;
        }

        /* --- SIGNATURES --- */
        .signatures-section {
            margin-top: var(--spacing-xl);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            page-break-inside: avoid;
        }

        .signature-box {
            text-align: center;
        }

        .signature-box .signature-title {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing);
            color: var(--color-label);
            margin-bottom: var(--spacing-xl);
        }

        .signature-box .signature-line {
            border-top: 1px solid var(--color-border);
            padding-top: var(--spacing-xs);
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
        }

        /* --- FOOTER --- */
        .doc-footer {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 0.5pt solid var(--color-border);
            font-size: var(--font-size-xs);
            color: var(--color-primary);
            text-align: center;
            line-height: 1.6;
        }

        /* --- PAGE NUMBER --- */
        .page-number {
            position: absolute;
            top: 10mm;
            right: 14mm;
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            html, body {
                background: var(--color-white);
                margin: 0;
                padding: 0;
            }

            .sidebar, .no-print { display: none !important; }

            .app-wrapper {
                padding: 0;
                margin: 0;
            }

            .document {
                box-shadow: none;
                padding: 15mm 12mm;
                width: 210mm;
                min-height: 296mm;
            }

            input, textarea {
                border-color: transparent !important;
                background: transparent !important;
            }

            .party-section {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            @page {
                size: A4;
                margin: 8mm;
            }
        }

        /* ===== RESPONSIVE ===== */
        @media screen and (max-width: 900px) {
            .app-wrapper {
                flex-direction: column;
                padding: 10px;
            }
            .sidebar {
                width: 100%;
                position: static;
            }
            .document {
                width: 100%;
                min-height: auto;
                padding: 16px;
            }
            .signatures-section {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: 6px;
            font-size: 12px;
            font-family: var(--font-primary);
            font-weight: 500;
            box-shadow: 0 8px 24px rgba(0,0,0,.15);
            opacity: 0;
            transform: translateY(20px);
            transition: all .3s ease;
            z-index: 999;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { background: #166534; }
        .toast.error   { background: #991B1B; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar no-print">
        <div class="sidebar-card logo-area">
            <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:22px;font-weight:600;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI<div style=&quot;font-size:8px;color:#757575;font-weight:400;margin-top:2px&quot;>Sp. z o.o. Sp.k.</div></div>'">
        </div>

        <div class="sidebar-card">
            <h3>Akcje</h3>
            <a href="../index.html" class="btn btn-secondary" style="text-decoration:none;margin-bottom:12px;">‚Üê Strona g≈Ç√≥wna</a>
            <button class="btn btn-primary" onclick="printDoc()">Drukuj / Zapisz PDF</button>
            <button class="btn btn-secondary" onclick="exportDOCX()">üìÑ Pobierz DOCX</button>
            <button class="btn btn-secondary" onclick="sendEmail()">‚úâ Wy≈õlij mailem</button>
            <button class="btn btn-secondary" onclick="sendWhatsApp()">üí¨ Wy≈õlij WhatsApp</button>
            <button class="btn btn-secondary" onclick="saveDocument()">Zapisz dokument</button>
            <button class="btn btn-secondary" onclick="newDocument()">Nowy dokument</button>
            <button class="btn btn-danger" onclick="clearForm()">Wyczy≈õƒá formularz</button>
        </div>

        <div class="sidebar-card">
            <h3>Specyfikacja mebli</h3>
            <div style="display:flex;gap:6px;">
                <button class="btn btn-secondary" onclick="addSpecRow()" style="flex:1;text-align:center;">+ Dodaj wiersz</button>
                <button class="btn btn-secondary" onclick="removeSpecRow()" style="flex:1;text-align:center;">‚àí Usu≈Ñ wiersz</button>
            </div>
        </div>

        <div class="sidebar-card">
            <h3>Historia dokument√≥w</h3>
            <div id="historyList" class="history-list">
                <div class="history-empty">Brak zapisanych dokument√≥w</div>
            </div>
        </div>
    </aside>

    <!-- ===== DOCUMENT ===== -->
    <main class="page-container">
        <div class="document" id="document">

            <!-- Page Number -->
            <div class="page-number">1</div>

            <!-- Header -->
            <div class="doc-header">
                <div class="logo">
                    <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:24px;font-weight:600;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI</div>'">
                </div>
            </div>

            <!-- Title -->
            <div class="doc-title">UMOWA Nr <input type="text" id="docNumber" value="P-XXX-26" style="width:100px;"></div>

            <!-- Contract Intro -->
            <div class="contract-intro">
                <p class="date-place">zawarta w dniu <input type="text" id="contractDate" placeholder="data"> w <input type="text" id="contractPlace" value="Toruniu" style="width:80px;"> pomiƒôdzy:</p>
            </div>

            <!-- Wykonawca -->
            <div class="party-section">
                <div class="party-title">Wykonawca</div>
                <div class="party-details">
                    <p><strong>WALABI Sp√≥≈ÇkƒÖ z ograniczonƒÖ odpowiedzialno≈õciƒÖ Sp√≥≈ÇkƒÖ komandytowƒÖ</strong></p>
                    <p>z siedzibƒÖ w Toruniu, ul. Kosynier√≥w Ko≈õciuszkowskich 13/4, 87-100 Toru≈Ñ,</p>
                    <p>zarejestrowanƒÖ w SƒÖdzie Rejonowym w Toruniu, VII Wydzia≈Ç Gospodarczy Krajowego Rejestru SƒÖdowego</p>
                    <p>pod numerem KRS 0000725731, REGON: 369866245, NIP: 8792700696,</p>
                    <p>reprezentowanƒÖ przez:</p>
                    <p>Leszka Borowskiego ‚Äì e-mail: leszek@walabi.pl, tel. 501 260 990</p>
                    <p>Jaros≈Çawa R√≥≈ºa≈Ñskiego ‚Äì e-mail: jarek@walabi.pl, tel. 501 266 670</p>
                    <p>zwanƒÖ dalej <strong>‚ÄûWykonawcƒÖ"</strong>,</p>
                </div>
            </div>

            <p style="text-align:center;margin:var(--spacing-sm) 0;font-size:var(--font-size-base);">a</p>

            <!-- ZamawiajƒÖcy -->
            <div class="party-section">
                <div class="party-title">ZamawiajƒÖcy</div>
                <div class="party-details">
                    <div class="field-row">
                        <input type="text" id="clientName" class="w-full" placeholder="[Pe≈Çna Nazwa ZamawiajƒÖcego / Firma]">
                    </div>
                    <div class="field-row">
                        z siedzibƒÖ w <input type="text" id="clientCity" class="w-150" placeholder="[Miejscowo≈õƒá]">, <input type="text" id="clientAddress" class="w-200" placeholder="[Adres]">
                    </div>
                    <div class="field-row">
                        NIP <input type="text" id="clientNIP" class="w-120" placeholder="[NIP ZamawiajƒÖcego]">
                    </div>
                    <div class="field-row">
                        tel.: <input type="text" id="clientPhone" class="w-120" placeholder="[Telefon]">, e-mail: <input type="text" id="clientEmail" class="w-220" placeholder="[E-mail]">
                    </div>
                    <p>zwanym dalej <strong>‚ÄûZamawiajƒÖcym"</strong>,</p>
                </div>
            </div>

            <p style="margin:var(--spacing-sm) 0;font-size:var(--font-size-base);">zwanymi ≈ÇƒÖcznie <strong>‚ÄûStronami"</strong>, a ka≈ºdy z osobna <strong>‚ÄûStronƒÖ"</strong>.</p>

            <!-- ¬ß1. PRZEDMIOT UMOWY -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß1. Przedmiot Umowy</div>
                <div class="paragraph-content">
                    <ol>
                        <li>ZamawiajƒÖcy zleca, a Wykonawca przyjmuje do realizacji zam√≥wienie obejmujƒÖce <input type="text" id="scopeOfWork" class="w-auto" value="produkcjƒô, dostawƒô i monta≈º" style="min-width:180px;"> <input type="text" id="furnitureType" class="w-auto" placeholder="[Opis Rodzaju Mebli/Zestawu Meblowego]"> (zwanych dalej "Meblami") wed≈Çug specyfikacji stanowiƒÖcej Za≈ÇƒÖcznik nr 1 do niniejszej Umowy oraz projektu/koncepcji stanowiƒÖcego Za≈ÇƒÖcznik nr 2.</li>
                        <li>Meble zostanƒÖ wykonane i zamontowane w lokalizacji: <input type="text" id="installationAddress" class="w-auto" placeholder="[Lokalizacja Monta≈ºu: Pe≈Çny Adres]"></li>
                        <li>Podstawƒô realizacji zam√≥wienia stanowiƒÖ:
                            <ol>
                                <li>Specyfikacja mebli wraz z wycenƒÖ (Za≈ÇƒÖcznik nr 1),</li>
                                <li>Projekt wykonawczy/Koncepcja (Za≈ÇƒÖcznik nr 2),</li>
                                <li>Uzgodnienia poczynione drogƒÖ elektronicznƒÖ (e-mail) pomiƒôdzy Stronami</li>
                                <li>ObowiƒÖzujƒÖce normy i przepisy techniczne.</li>
                            </ol>
                        </li>
                        <li>W przypadku rozbie≈ºno≈õci pomiƒôdzy tre≈õciƒÖ dokument√≥w wymienionych w ust. 3, pierwsze≈Ñstwo majƒÖ postanowienia niniejszej Umowy, nastƒôpnie Za≈ÇƒÖcznik nr 1 i Za≈ÇƒÖcznik nr 2, a nastƒôpnie uzgodnienia poczynione drogƒÖ elektronicznƒÖ.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß2. TERMINY REALIZACJI -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß2. Terminy Realizacji</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Termin realizacji przedmiotu umowy ustala siƒô na: <input type="text" id="termWeeksFrom" style="width:30px;text-align:center;" placeholder="8"> do <input type="text" id="termWeeksTo" style="width:30px;text-align:center;" placeholder="10"> tygodni od daty podpisania umowy.</li>
                        <li style="text-align:left;"><input type="text" id="termAdditionalInfo" style="width:100%;box-sizing:border-box;text-align:left;" placeholder="Dodatkowe informacje o terminie..."></li>
                        <li>Przez realizacjƒô przedmiotu umowy rozumie siƒô wykonanie i monta≈º wszystkich Mebli wymienionych w Za≈ÇƒÖczniku nr 1.</li>
                        <li>Termin realizacji mo≈ºe ulec zmianie w przypadku:
                            <ol>
                                <li>Dzia≈Çania si≈Çy wy≈ºszej,</li>
                                <li>Wprowadzenia zmian w projekcie lub specyfikacji przez ZamawiajƒÖcego,</li>
                                <li>Nieterminowego przygotowania miejsca monta≈ºu przez ZamawiajƒÖcego,</li>
                                <li>WystƒÖpienia okoliczno≈õci niezale≈ºnych od Wykonawcy, kt√≥rych nie m√≥g≈Ç on przewidzieƒá przy dochowaniu nale≈ºytej staranno≈õci.</li>
                            </ol>
                        </li>
                        <li>W przypadku zaistnienia okoliczno≈õci wymienionych w ust. 3, Wykonawca poinformuje ZamawiajƒÖcego o nowym terminie realizacji zam√≥wienia.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß3. OBOWIƒÑZKI STRON -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß3. ObowiƒÖzki Stron</div>
                <div class="paragraph-content">
                    <ol>
                        <li>ZamawiajƒÖcy zobowiƒÖzuje siƒô do:
                            <ol>
                                <li>Umo≈ºliwienia Wykonawcy dokonania pomiar√≥w w miejscu monta≈ºu minimum 6 tygodni przed planowanym terminem realizacji,</li>
                                <li>Zapewnienia Wykonawcy swobodnego dostƒôpu do miejsca monta≈ºu w uzgodnionym terminie,</li>
                                <li>Przygotowania miejsca monta≈ºu przez usuniƒôcie przedmiot√≥w mogƒÖcych utrudniaƒá monta≈º,</li>
                                <li>Zapewnienia dostƒôpu do medi√≥w (energia elektryczna, woda) niezbƒôdnych do monta≈ºu,</li>
                                <li>Terminowej realizacji p≈Çatno≈õci zgodnie z ¬ß 6,</li>
                                <li>Niezw≈Çocznego podejmowania decyzji zwiƒÖzanych z realizacjƒÖ przedmiotu umowy,</li>
                                <li>Odbioru kompletnych i prawid≈Çowo wykonanych Mebli.</li>
                            </ol>
                        </li>
                        <li>Wykonawca zobowiƒÖzuje siƒô do:
                            <ol>
                                <li>Wykonania przedmiotu umowy zgodnie z za≈ÇƒÖczonƒÖ specyfikacjƒÖ, projektem oraz uzgodnieniami,</li>
                                <li>Dokonania niezbƒôdnych pomiar√≥w przed rozpoczƒôciem produkcji,</li>
                                <li>Stosowania materia≈Ç√≥w zgodnych ze specyfikacjƒÖ i obowiƒÖzujƒÖcymi normami,</li>
                                <li>Wykonania monta≈ºu z nale≈ºytƒÖ staranno≈õciƒÖ,</li>
                                <li>Usuniƒôcia odpad√≥w powsta≈Çych podczas monta≈ºu,</li>
                                <li>Wydania instrukcji u≈ºytkowania Mebli oraz dokument√≥w gwarancyjnych.</li>
                            </ol>
                        </li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß4. ODBI√ìR -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß4. Odbi√≥r</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Odbi√≥r przedmiotu umowy nastƒÖpi po zako≈Ñczeniu monta≈ºu Mebli, na podstawie protoko≈Çu odbioru podpisanego przez obie Strony.</li>
                        <li>ZamawiajƒÖcy zobowiƒÖzany jest uczestniczyƒá w odbiorze osobi≈õcie lub wyznaczyƒá osobƒô upowa≈ºnionƒÖ do reprezentowania go podczas odbioru.</li>
                        <li>W przypadku nieobecno≈õci ZamawiajƒÖcego w ustalonym terminie odbioru, Wykonawca sporzƒÖdzi jednostronny protok√≥≈Ç odbioru, kt√≥ry bƒôdzie wiƒÖ≈ºƒÖcy dla Stron, pod warunkiem udokumentowania wykonania prac w formie fotograficznej lub filmowej, wraz z opisem technicznym i zestawieniem wykonanych pozycji z Za≈ÇƒÖcznika nr 1.</li>
                        <li>W przypadku op√≥≈∫nienia odbioru mebli przez ZamawiajƒÖcego przekraczajƒÖcego 7 dni od ustalonego terminu, Wykonawca ma prawo naliczyƒá op≈Çatƒô magazynowƒÖ w wysoko≈õci 150 z≈Ç netto za ka≈ºdy dzie≈Ñ przechowywania, liczony od 8. dnia op√≥≈∫nienia.</li>
                        <li>Wykonawca zobowiƒÖzuje siƒô do usuniƒôcia wad i usterek w terminie 14 dni od daty ich zg≈Çoszenia, chyba ≈ºe z przyczyn technologicznych wymagany bƒôdzie d≈Çu≈ºszy termin, kt√≥ry zostanie ustalony przez Strony.</li>
                        <li>Po usuniƒôciu wad i usterek Strony sporzƒÖdzƒÖ dodatkowy protok√≥≈Ç odbioru.</li>
                        <li>Niedopuszczalny jest zwrot Mebli wykonanych zgodnie z zam√≥wieniem.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß5. OSOBY KONTAKTOWE -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß5. Osoby Kontaktowe</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Osobami upowa≈ºnionymi do kontakt√≥w w sprawach zwiƒÖzanych z wykonaniem umowy sƒÖ:</li>
                    </ol>
                    <p style="margin-top: var(--spacing-sm);">Ze strony Wykonawcy:</p>
                    <ol>
                        <li>Leszek Borowski, tel. 501 260 990, e-mail: leszek@walabi.pl</li>
                        <li>Jaros≈Çaw R√≥≈ºa≈Ñski, tel. 501 266 670, e-mail: jarek@walabi.pl</li>
                    </ol>
                    <p style="margin-top: var(--spacing-sm);">Ze strony ZamawiajƒÖcego:</p>
                    <ol start="3">
                        <li><input type="text" id="contactPerson1Name" class="w-auto" placeholder="[Imiƒô i Nazwisko]">, tel. <input type="text" id="contactPerson1Phone" class="w-120" placeholder="[Numer Telefonu]">, e-mail: <input type="text" id="contactPerson1Email" class="w-220" placeholder="[Adres E-mail]"></li>
                        <li><input type="text" id="contactPerson2Name" class="w-auto" placeholder="[Imiƒô i Nazwisko / Funkcja]">, e-mail: <input type="text" id="contactPerson2Email" class="w-220" placeholder="[Adres E-mail]">, upowa≈ºniona jest do dokonywania uzgodnie≈Ñ i akceptacji w zakresie rozwiƒÖza≈Ñ projektowych, kolorystyki i materia≈Ç√≥w. <input type="text" id="contactPerson2Note" class="w-auto" placeholder="[Opcjonalnie, je≈õli jest inna osoba upowa≈ºniona]"></li>
                    </ol>
                    <ol start="5">
                        <li>Zmiana os√≥b wskazanych w ust. 1 i 2 nie wymaga aneksu do umowy i mo≈ºe byƒá dokonana poprzez pisemne powiadomienie drugiej Strony.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß6. WYNAGRODZENIE I WARUNKI P≈ÅATNO≈öCI -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß6. Wynagrodzenie i Warunki P≈Çatno≈õci</div>
                <div class="paragraph-content">
                    <p>Za wykonanie przedmiotu umowy ZamawiajƒÖcy zap≈Çaci Wykonawcy wynagrodzenie w wysoko≈õci:</p>
                    <ul style="list-style-type: disc; margin-left: 20px; margin-top: var(--spacing-sm);">
                        <li>Warto≈õƒá netto: <input type="text" id="priceNetto" class="w-120" placeholder="[Warto≈õƒá netto]"> z≈Ç</li>
                        <li>Podatek VAT (23%): <input type="text" id="priceVat" class="w-120" placeholder="[Warto≈õƒá VAT]"> z≈Ç</li>
                        <li>Warto≈õƒá brutto: <input type="text" id="priceBrutto" class="w-120" placeholder="[Warto≈õƒá brutto]"> z≈Ç</li>
                        <li>S≈Çownie brutto: <input type="text" id="priceBruttoWords" class="w-auto" placeholder="[S≈Çownie brutto]"></li>
                        <li>Koszty transportu:
                            <select id="transportCost" style="margin-left:10px; padding:2px 5px;">
                                <option value="">-- wybierz --</option>
                                <option value="separate">transport rozliczany osobno</option>
                                <option value="included">transport wliczony w cenƒô</option>
                            </select>
                        </li>
                    </ul>
                    <p style="margin-top: var(--spacing-md);">Wynagrodzenie p≈Çatne bƒôdzie w nastƒôpujƒÖcych transzach:</p>
                    <ul style="list-style-type: disc; margin-left: 20px; margin-top: var(--spacing-sm);">
                        <li>Pierwsza p≈Çatno≈õƒá w wysoko≈õci (<input type="text" id="payment1Percent" class="w-40" value="50">%): <input type="text" id="payment1Amount" class="w-120" placeholder="[Kwota 1. Transzy]"> brutto p≈Çatna <input type="text" id="payment1Days" class="w-60" placeholder="[Liczba]"> dni po podpisaniu umowy,</li>
                        <li>Druga p≈Çatno≈õƒá w wysoko≈õci (<input type="text" id="payment2Percent" class="w-40" value="45">%): <input type="text" id="payment2Amount" class="w-120" placeholder="[Kwota 2. Transzy]"> brutto p≈Çatna przed dostawƒÖ</li>
                        <li>Pozosta≈Ça kwota w wysoko≈õci (<input type="text" id="payment3Percent" class="w-40" value="5">%): <input type="text" id="payment3Amount" class="w-120" placeholder="[Kwota 3. Transzy]"> brutto, p≈Çatna w terminie 3 dni od daty monta≈ºu i podpisania protoko≈Çu odbioru.</li>
                    </ul>
                    <ol style="margin-top: var(--spacing-md);">
                        <li>P≈Çatno≈õci bƒôdƒÖ dokonywane przelewem na rachunek bankowy Wykonawcy: <strong>mBank 48 1140 2004 0000 3602 7758 4396</strong></li>
                        <li>Faktury VAT bƒôdƒÖ wystawiane i przesy≈Çane drogƒÖ elektronicznƒÖ na adres e-mail: <input type="text" id="invoiceEmail" class="w-220" placeholder="[E-mail ZamawiajƒÖcego do faktur]"></li>
                        <li>W przypadku op√≥≈∫nienia w p≈Çatno≈õciach Wykonawca ma prawo naliczyƒá odsetki umowne w wysoko≈õci 0,1 % za ka≈ºdy dzie≈Ñ zw≈Çoki.</li>
                        <li>W przypadku op√≥≈∫nienia uko≈Ñczenia realizacji przedmiotu umowy przez Wykonawcƒô, ZamawiajƒÖcy ma prawo naliczaƒá odsetki umowne w wysoko≈õci 0,1% warto≈õci niezrealizowanego etapu prac, wzglƒôdnie niedostarczonego wyposa≈ºenia, z wy≈ÇƒÖczeniem przypadk√≥w dzia≈Çania si≈Çy wy≈ºszej lub op√≥≈∫nie≈Ñ wynikajƒÖcych z winy ZamawiajƒÖcego.</li>
                        <li>Wykonawca zastrzega sobie prawo w≈Çasno≈õci Mebli do czasu uiszczenia ca≈Ço≈õci wynagrodzenia przez ZamawiajƒÖcego. W przypadku braku zap≈Çaty w terminie, Wykonawca ma prawo odebraƒá Meble bez uprzedniego wezwania, a ZamawiajƒÖcy zobowiƒÖzuje siƒô do umo≈ºliwienia takiego odbioru.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß7. GWARANCJA -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß7. Gwarancja</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Wykonawca udziela <input type="text" id="warrantyMonths" style="width:30px;text-align:center;" placeholder="60"> miesiƒôcy gwarancji na wykonane Meble, liczonej od daty podpisania protoko≈Çu odbioru.</li>
                        <li>Szczeg√≥≈Çowe warunki gwarancji okre≈õla Za≈ÇƒÖcznik nr 3 ‚Äì ‚ÄûZalecenia i warunki gwarancji".</li>
                        <li>Gwarancja nie obejmuje:
                            <ol>
                                <li>Uszkodze≈Ñ mechanicznych powsta≈Çych z winy u≈ºytkownika,</li>
                                <li>Uszkodze≈Ñ wynikajƒÖcych z nieprawid≈Çowej eksploatacji, niezgodnej z zaleceniami Wykonawcy,</li>
                                <li>Naturalnego zu≈ºycia materia≈Ç√≥w w wyniku normalnego u≈ºytkowania,</li>
                                <li>Uszkodze≈Ñ powsta≈Çych w wyniku dzia≈Çania czynnik√≥w zewnƒôtrznych, na kt√≥re Wykonawca nie mia≈Ç wp≈Çywu.</li>
                            </ol>
                        </li>
                        <li>ZamawiajƒÖcy traci uprawnienia z tytu≈Çu gwarancji w przypadku:
                            <ol>
                                <li>Dokonania napraw lub modyfikacji Mebli przez osoby nieupowa≈ºnione przez Wykonawcƒô,</li>
                                <li>Niew≈Ça≈õciwego u≈ºytkowania Mebli,</li>
                                <li>Nieprzestrzegania zalece≈Ñ zawartych w instrukcji u≈ºytkowania.</li>
                            </ol>
                        </li>
                        <li>Zg≈Çoszenia reklamacyjne nale≈ºy kierowaƒá na adres e-mail: <strong>poczta@walabi.pl</strong> lub telefonicznie pod numerem: <strong>501 260 990</strong>.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß8. ODSTƒÑPIENIE OD UMOWY -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß8. OdstƒÖpienie od Umowy</div>
                <div class="paragraph-content">
                    <ol>
                        <li>ZamawiajƒÖcy mo≈ºe odstƒÖpiƒá od umowy w przypadku:
                            <ol>
                                <li>Op√≥≈∫nienia w realizacji przedmiotu umowy przekraczajƒÖcego 30 dni z przyczyn le≈ºƒÖcych wy≈ÇƒÖcznie po stronie Wykonawcy,</li>
                                <li>Ra≈ºƒÖcego naruszenia przez Wykonawcƒô postanowie≈Ñ niniejszej umowy.</li>
                            </ol>
                        </li>
                        <li>Wykonawca mo≈ºe odstƒÖpiƒá od umowy w przypadku:
                            <ol>
                                <li>Op√≥≈∫nienia w p≈Çatno≈õciach przekraczajƒÖcego 14 dni,</li>
                                <li>Niemo≈ºno≈õci wykonania pomiar√≥w z przyczyn le≈ºƒÖcych po stronie ZamawiajƒÖcego,</li>
                                <li>Braku wsp√≥≈Çdzia≈Çania ze strony ZamawiajƒÖcego uniemo≈ºliwiajƒÖcego realizacjƒô umowy.</li>
                            </ol>
                        </li>
                        <li>OdstƒÖpienie od umowy wymaga formy pisemnej pod rygorem niewa≈ºno≈õci.</li>
                        <li>W przypadku odstƒÖpienia od umowy przez ZamawiajƒÖcego z przyczyn le≈ºƒÖcych po jego stronie, Wykonawca zachowuje prawo do otrzymanej zaliczki, kt√≥ra stanowi odszkodowanie za poniesione koszty i utracone korzy≈õci. W przypadku poniesienia dodatkowych, udokumentowanych koszt√≥w (w tym zakupu materia≈Ç√≥w, zarezerwowania zasob√≥w lub logistyki), Wykonawca ma prawo dochodziƒá ich zwrotu w ca≈Ço≈õci.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß9. OCHRONA DANYCH OSOBOWYCH -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß9. Ochrona Danych Osobowych</div>
                <div class="paragraph-content">
                    <ol>
                        <li>ZamawiajƒÖcy wyra≈ºa zgodƒô na przetwarzanie jego danych osobowych przez Wykonawcƒô w zakresie niezbƒôdnym do realizacji niniejszej umowy, zgodnie z RozporzƒÖdzeniem Parlamentu Europejskiego i Rady (UE) 2016/679 z dnia 27 kwietnia 2016 r. (RODO).</li>
                        <li>Administratorem danych osobowych jest WALABI Sp. z o.o. Sp.k. z siedzibƒÖ w Toruniu.</li>
                        <li>Dane osobowe bƒôdƒÖ przetwarzane wy≈ÇƒÖcznie w celu realizacji niniejszej umowy oraz wykonania obowiƒÖzk√≥w wynikajƒÖcych z przepis√≥w prawa.</li>
                        <li>ZamawiajƒÖcy ma prawo dostƒôpu do tre≈õci swoich danych, ich sprostowania, usuniƒôcia lub ograniczenia przetwarzania oraz prawo do wniesienia sprzeciwu wobec przetwarzania.</li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß10. POSTANOWIENIA KO≈ÉCOWE -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß10. Postanowienia Ko≈Ñcowe</div>
                <div class="paragraph-content">
                    <ol>
                        <li>W sprawach nieuregulowanych niniejszƒÖ umowƒÖ majƒÖ zastosowanie przepisy Kodeksu cywilnego.</li>
                        <li>Wszelkie zmiany i uzupe≈Çnienia niniejszej umowy wymagajƒÖ formy pisemnej pod rygorem niewa≈ºno≈õci.</li>
                        <li>Strony zobowiƒÖzujƒÖ siƒô dƒÖ≈ºyƒá do polubownego rozwiƒÖzywania spor√≥w wynikajƒÖcych z niniejszej umowy, w szczeg√≥lno≈õci poprzez mediacjƒô prowadzonƒÖ przez Centrum Mediacji przy Krajowej Izbie Gospodarczej. W przypadku niemo≈ºno≈õci osiƒÖgniƒôcia porozumienia, spory bƒôdƒÖ rozstrzygane przez sƒÖd w≈Ça≈õciwy dla siedziby Wykonawcy.</li>
                        <li>Umowƒô sporzƒÖdzono w dw√≥ch jednobrzmiƒÖcych egzemplarzach, po jednym dla ka≈ºdej ze Stron.</li>
                        <li>Strony dopuszczajƒÖ mo≈ºliwo≈õƒá podpisania umowy w formie elektronicznej, poprzez wymianƒô skan√≥w podpisanych dokument√≥w w formacie PDF.</li>
                        <li>IntegralnƒÖ czƒô≈õƒá umowy stanowiƒÖ za≈ÇƒÖczniki:
                            <ol>
                                <li>Za≈ÇƒÖcznik nr 1 ‚Äì Specyfikacja mebli wraz z wycenƒÖ</li>
                                <li>Za≈ÇƒÖcznik nr 2 ‚Äì Projekt wykonawczy/Koncepcja</li>
                                <li>Za≈ÇƒÖcznik nr 3 ‚Äì Zalecenia i warunki gwarancji</li>
                            </ol>
                        </li>
                    </ol>
                </div>
            </div>

            <!-- ¬ß11. WALORYZACJA -->
            <div class="paragraph-section">
                <div class="paragraph-title">¬ß11. Waloryzacja</div>
                <div class="paragraph-content">
                    <ol>
                        <li>W przypadku wzrostu cen materia≈Ç√≥w budowlanych lub komponent√≥w meblowych przekraczajƒÖcego 10% w stosunku do daty podpisania umowy, Strony zobowiƒÖzujƒÖ siƒô do renegocjacji wynagrodzenia. PodstawƒÖ do waloryzacji bƒôdƒÖ og√≥lnodostƒôpne dane rynkowe lub zestawienia z dostawc√≥w.</li>
                        <li>W przypadku braku porozumienia co do nowej ceny w terminie 14 dni od wezwania do renegocjacji, Wykonawca ma prawo zawiesiƒá realizacjƒô zam√≥wienia do czasu osiƒÖgniƒôcia porozumienia lub rozwiƒÖzaƒá umowƒô z zachowaniem prawa do rozliczenia prac wykonanych dotychczas.</li>
                    </ol>
                </div>
            </div>

            <!-- Signatures -->
            <div class="signatures-section">
                <div class="signature-box">
                    <div class="signature-title">Wykonawca:</div>
                    <div class="signature-line">........................................</div>
                </div>
                <div class="signature-box">
                    <div class="signature-title">ZamawiajƒÖcy:</div>
                    <div class="signature-line">........................................</div>
                </div>
            </div>

            <!-- Page Break for Za≈ÇƒÖcznik 1 -->
            <div style="page-break-before: always;"></div>

            <!-- ZA≈ÅƒÑCZNIK NR 1 -->
            <div class="paragraph-section" style="margin-top: 20mm;">
                <div class="doc-title" style="font-size: var(--font-size-lg);">ZA≈ÅƒÑCZNIK NR 1 DO UMOWY NR <span id="attachDocNum1">P-XXX-26</span></div>
                <div class="paragraph-title" style="margin-top: var(--spacing-lg);">Specyfikacja mebli wraz z wycenƒÖ</div>
                <div class="paragraph-content">
                    <table style="width:100%; border-collapse: collapse; margin: var(--spacing-md) 0; font-size: var(--font-size-base);">
                        <thead>
                            <tr style="background: var(--color-highlight);">
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; width: 30px;">L.P.</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center;">Opis mebla</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; width: 80px;">Wymiary (cm)</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; width: 40px;">Ilo≈õƒá</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; width: 35px;">J.m.</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: right; width: 90px;">Cena netto (z≈Ç)</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: right; width: 100px;">Warto≈õƒá netto (z≈Ç)</th>
                            </tr>
                        </thead>
                        <tbody id="specTableBody">
                            <!-- Wiersze generowane dynamicznie przez JavaScript -->
                        </tbody>
                    </table>

                    <p style="margin-top: var(--spacing-lg); font-weight: 600;">Podsumowanie koszt√≥w</p>
                    <table style="width:100%; border-collapse: collapse; margin: var(--spacing-sm) 0; font-size: var(--font-size-base);">
                        <tr>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Warto≈õƒá mebli ‚Äì pozycje podstawowe</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right; width: 120px;" id="sumMebli">0,00</td>
                        </tr>
                        <tr>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Pozycje dodatkowe</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;"><input type="text" id="sumDodatkowe" value="0,00" style="border:none;text-align:right;width:100%;"></td>
                        </tr>
                        <tr>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Transport <input type="text" id="transportUwagi" placeholder="uwagi..." style="border:none;border-bottom:1px dotted #999;width:60%;margin-left:5px;"></td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;"><input type="text" id="sumTransport" value="" placeholder="" style="border:none;text-align:right;width:100%;"></td>
                        </tr>
                        <tr>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Monta≈º</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;"><input type="text" id="sumMontaz" value="0,00" style="border:none;text-align:right;width:100%;"></td>
                        </tr>
                        <tr style="font-weight: 600;">
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Razem netto</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="sumNettoSpec">0,00</td>
                        </tr>
                        <tr>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">VAT 23 %</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="sumVatSpec">0,00</td>
                        </tr>
                        <tr style="font-weight: 600;">
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px;">Razem brutto</td>
                            <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="sumBruttoSpec">0,00</td>
                        </tr>
                    </table>

                    <p style="margin-top: var(--spacing-lg); font-weight: 600;">Harmonogram p≈Çatno≈õci</p>
                    <table style="width:100%; border-collapse: collapse; margin: var(--spacing-sm) 0; font-size: var(--font-size-base);">
                        <thead>
                            <tr style="background: var(--color-highlight);">
                                <th style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center; width: 80px;">Transza</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">Termin p≈Çatno≈õci</th>
                                <th style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right; width: 120px;">Kwota brutto (z≈Ç)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">1. <span id="harmPercent1">50</span> %</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">3 dni po podpisaniu umowy</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="harmAmount1">0,00</td>
                            </tr>
                            <tr>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">2. <span id="harmPercent2">45</span> %</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">przed dostawƒÖ</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="harmAmount2">0,00</td>
                            </tr>
                            <tr>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">3. <span id="harmPercent3">5</span> %</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: center;">w 3 dni od monta≈ºu i protoko≈Çu odbioru</td>
                                <td style="border: 0.5pt solid var(--color-border); padding: 6px; text-align: right;" id="harmAmount3">0,00</td>
                            </tr>
                        </tbody>
                    </table>

                    <p style="margin-top: var(--spacing-lg);">Specyfikacja stanowi integralnƒÖ czƒô≈õƒá Umowy nr <span id="attachDocNum1b">P-XXX-26</span>.</p>
                    <p style="margin-top: var(--spacing-sm);">Oferta nie obejmuje:</p>
                    <textarea id="ofertaWylaczenia" rows="3" style="width:100%; border: 0.5pt solid var(--color-border); padding: 6px; font-family: var(--font-primary); font-size: var(--font-size-base);" placeholder="np. - ≈Å√≥≈ºko: tkaniny obiciowej - do ustalenia,&#10;- szafka podumywalkowa: zakupu umywalki i armatury oraz blat√≥w FLORIM TUNDRA (spiek kwarcowy)."></textarea>
                </div>
            </div>

            <!-- Page Break for Za≈ÇƒÖcznik 3 -->
            <div style="page-break-before: always;"></div>

            <!-- ZA≈ÅƒÑCZNIK NR 3 -->
            <div class="paragraph-section" style="margin-top: 20mm;">
                <div class="doc-title" style="font-size: var(--font-size-lg);">ZA≈ÅƒÑCZNIK NR 3 DO UMOWY NR <span id="attachDocNum3">P-XXX-26</span></div>

                <div class="paragraph-title" style="margin-top: var(--spacing-lg);">Zalecenia i warunki gwarancji meble ‚Äûtwarde" ‚Äì Zalecenia u≈ºytkowania</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Meble nale≈ºy u≈ºytkowaƒá zgodnie z ich konstrukcjƒÖ i przeznaczeniem.</li>
                        <li>Meble nale≈ºy u≈ºytkowaƒá w pomieszczeniach suchych, zamkniƒôtych i zabezpieczonych przed szkodliwymi warunkami atmosferycznymi oraz bezpo≈õrednim dzia≈Çaniem promieni s≈Çonecznych.</li>
                        <li>Normalne warunki klimatyczne u≈ºytkowania mebli:
                            <ul style="list-style-type: circle; margin-left: 20px;">
                                <li>wilgotno≈õƒá wzglƒôdna powietrza 40-70%</li>
                                <li>temperatura 15-30¬∞C</li>
                            </ul>
                        </li>
                        <li>Mebli nie nale≈ºy ustawiaƒá w odleg≈Ço≈õci mniejszej ni≈º 1m od czynnych grzejnik√≥w.</li>
                        <li>Polakierowane powierzchnie mebli nale≈ºy chroniƒá przed zarysowaniem i obiciem.</li>
                        <li>Nale≈ºy unikaƒá d≈Çugotrwa≈Çego kontaktu polakierowanych powierzchni z wysokimi temperaturami i rozpuszczalnikami. Czynniki te mogƒÖ r√≥wnie≈º wp≈ÇynƒÖƒá na uszkodzenie pow≈Çoki lakierowanej objawiajƒÖce siƒô w postaci odbarwie≈Ñ i zmatowie≈Ñ.</li>
                        <li>Do czyszczenia element√≥w drewnianych nie zalecamy ≈õrodk√≥w PRONTO!</li>
                    </ol>
                </div>

                <div class="paragraph-title" style="margin-top: var(--spacing-md);">Wy≈ÇƒÖczenia z gwarancji</div>
                <div class="paragraph-content">
                    <p>Utrata uprawnie≈Ñ gwarancyjnych nastƒôpuje w przypadkach:</p>
                    <ol>
                        <li>U≈ºytkowania mebla w zakresie temperatur poni≈ºej 15¬∞C lub powy≈ºej 30¬∞C.</li>
                        <li>U≈ºytkowania mebla w zakresie wilgotno≈õci powietrza poni≈ºej 40% lub powy≈ºej 70%.</li>
                        <li>Zalania mebla wodƒÖ lub innƒÖ cieczƒÖ.</li>
                        <li>U≈ºytkowania mebla niezgodnie z przeznaczeniem.</li>
                        <li>Zabrudze≈Ñ wyrob√≥w.</li>
                        <li>Stwierdzenia niew≈Ça≈õciwego wykonania zabieg√≥w czyszczenia i konserwacji.</li>
                        <li>Stwierdzenia pr√≥b wykonania naprawy lub poprawek przez osoby nieuprawnione.</li>
                        <li>Szk√≥d i usterek spowodowanych przez zwierzƒôta.</li>
                        <li>Szk√≥d powsta≈Çych w wyniku niew≈Ça≈õciwego przewo≈ºenia mebli przez Klient√≥w, np. podczas przeprowadzki. Przez niew≈Ça≈õciwe przewo≈ºenie nale≈ºy rozumieƒá nie zachowanie nale≈ºytej staranno≈õci w zabezpieczeniu przewo≈ºonych element√≥w.</li>
                        <li>Uszkodze≈Ñ mechanicznych.</li>
                    </ol>
                    <p style="margin-top: var(--spacing-sm);">Gwarancja nie obowiƒÖzuje, gdy towar zosta≈Ç uszkodzony mechanicznie wskutek nieprawid≈Çowego u≈ºywania.</p>
                </div>

                <div class="paragraph-title" style="margin-top: var(--spacing-md);">Meble tapicerowane ‚Äì Zasady u≈ºytkowania i konserwacji</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Meble tapicerowane powinny byƒá u≈ºytkowane zgodnie z ich przeznaczeniem. Siadanie lub stawanie na p≈Çytƒô zag≈Ç√≥wka, na boczkach, pod≈Çokietnikach, krawƒôdziach oparƒá i siedzisk mo≈ºe doprowadziƒá do nieodwracalnych zmian w meblu.</li>
                        <li>Przy rozpakowaniu nie nale≈ºy u≈ºywaƒá ostrych narzƒôdzi, gdy≈º mo≈ºe to spowodowaƒá uszkodzenie obicia mebla.</li>
                        <li>Podczas przestawiania meble nale≈ºy przenosiƒá, chwytajƒÖc je od spodu za sztywne czƒô≈õci konstrukcji no≈õnej. Nie nale≈ºy trzymaƒá za obicie lub jego lu≈∫ne elementy.</li>
                        <li>Mebli tapicerowanych nie nale≈ºy stawiaƒá w odleg≈Ço≈õci mniejszej ni≈º 1 m od czynnych ≈∫r√≥de≈Ç ciep≈Ça takich jak grzejniki, kuchenki, piece.</li>
                        <li>Meble nale≈ºy chroniƒá przed szkodliwym wp≈Çywem warunk√≥w atmosferycznych oraz bezpo≈õrednim dzia≈Çaniem promieni s≈Çonecznych.</li>
                        <li>Materia≈Ç pokryciowy nale≈ºy utrzymywaƒá w czysto≈õci. Tkaniny szczotkowaƒá od czasu do czasu miƒôkkƒÖ szczotkƒÖ z naturalnego w≈Çosia bƒÖd≈∫ odkurzaƒá przy u≈ºyciu nasadki czyszczƒÖcej do tapicerki.</li>
                        <li>Zabrudzenia czy≈õciƒá miƒôkkƒÖ, bawe≈ÇnianƒÖ ≈õciereczkƒÖ delikatnie nasƒÖczonƒÖ roztworem szarego myd≈Ça i wody. Nale≈ºy unikaƒá przemoczenia materia≈Çu pokryciowego.</li>
                        <li>Nie nale≈ºy stosowaƒá chemicznych ≈õrodk√≥w czyszczƒÖcych zawierajƒÖcych w sk≈Çadzie naftƒô, alkohol lub inne rozpuszczalniki.</li>
                        <li>P≈Çynne zbrudzenia usuwaƒá natychmiast poprzez osuszenie dobrze wch≈ÇaniajƒÖcƒÖ ≈õciereczkƒÖ.</li>
                    </ol>
                </div>

                <div class="paragraph-title" style="margin-top: var(--spacing-md);">Warunki gwarancji</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Gwarant zapewnia nale≈ºytƒÖ jako≈õƒá mebli przy zachowaniu zasad ich u≈ºytkowania zgodnie z przeznaczeniem.</li>
                        <li>Reklamacje na wady objƒôte gwarancjƒÖ KupujƒÖcy sk≈Çada w formie pisemnej w terminie nie d≈Çu≈ºszym ni≈º 14 dni od daty ujawnienia wady.</li>
                        <li>Rozpatrzenie reklamacji nastƒÖpi w terminie do 14 dni od daty zg≈Çoszenia reklamacji Gwarantowi.</li>
                        <li>Realizacja reklamacji w drodze nieodp≈Çatnej naprawy nastƒÖpi do 30 dni od daty jej rozpatrzenia.</li>
                        <li>O przyjƒôciu reklamacji do realizacji w drodze naprawy lub o uznaniu reklamacji za nieuzasadnionƒÖ KupujƒÖcy zostanie powiadomiony niezw≈Çocznie.</li>
                        <li>W przypadku gdy wada jest usuwalna, reklamacja bƒôdzie za≈Çatwiona w drodze naprawy u KupujƒÖcego lub w zak≈Çadzie Gwaranta.</li>
                        <li>W przypadku gdy wada jest nieusuwalna, reklamacja bƒôdzie za≈Çatwiana w drodze obni≈ºenia ceny mebla lub wymiany mebla na nowy, wolny od wad.</li>
                    </ol>
                </div>

                <div class="paragraph-title" style="margin-top: var(--spacing-md);">GwarancjƒÖ nie sƒÖ objƒôte</div>
                <div class="paragraph-content">
                    <ol>
                        <li>Zabrudzenia, efekty niew≈Ça≈õciwych pr√≥b czyszczenia, jak r√≥wnie≈º szkody spowodowane przez zwierzƒôta domowe.</li>
                        <li>Uszkodzenia mechaniczne powsta≈Çe w wyniku niew≈Ça≈õciwego u≈ºytkowania.</li>
                        <li>Zmiany wynikajƒÖce z napraw lub przer√≥bek mebli wykonanych przez lub na zlecenie KupujƒÖcego.</li>
                        <li>Uszkodzenia powsta≈Çe w wyniku niew≈Ça≈õciwego bƒÖd≈∫ nieostro≈ºnego przewozu, przenoszenia mebli.</li>
                        <li>Wady i uszkodzenia, w wyniku kt√≥rych obni≈ºono cenƒô wyrobu.</li>
                        <li>Zmiany zachodzƒÖce naturalnie w wyniku eksploatacji mebla.</li>
                        <li>Zr√≥≈ºnicowane zu≈ºycie spowodowane nier√≥wnomiernƒÖ eksploatacjƒÖ poszczeg√≥lnych powierzchni.</li>
                        <li>R√≥≈ºnice w twardo≈õci i wysoko≈õci pojedynczych element√≥w i podzespo≈Ç√≥w.</li>
                        <li>Pofa≈Çdowania i r√≥≈ºnorodno≈õci powierzchni mebla wynikajƒÖce z zaprojektowanych cech wzoru.</li>
                    </ol>
                </div>

                <div class="paragraph-title" style="margin-top: var(--spacing-md);">Uwaga:</div>
                <div class="paragraph-content">
                    <p>W przypadku nieuzasadnionej reklamacji, w szczeg√≥lno≈õci w przypadku stwierdzenia braku wady lub w przypadku uszkodzenia lub pogorszenia stanu towaru z przyczyn, za kt√≥re Wykonawca nie ponosi odpowiedzialno≈õci, Klient mo≈ºe zostaƒá obciƒÖ≈ºony kosztami.</p>
                    <p style="margin-top: var(--spacing-md);">Dokument jest za≈ÇƒÖcznikiem do Umowy nr <span id="attachDocNum3b">P-XXX-26</span> z dnia <span id="attachDate3">__________</span> r.</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="doc-footer">
                <div class="company-legal">WALABI Sp. z o.o. Sp.k. ¬∑ ul. Kosynier√≥w Ko≈õciuszkowskich 13/4 ¬∑ 87-100 Toru≈Ñ</div>
                <div class="company-registration">KRS: 0000725731 ¬∑ NIP: 8792700696 ¬∑ REGON: 369866245 ¬∑ Tel: +48 501 260 990 ¬∑ poczta@walabi.pl</div>
            </div>

        </div>
    </main>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js"></script>

<!-- docx library for DOCX export -->
<script src="https://unpkg.com/docx@8.2.2/build/index.umd.js"></script>

<script>
    // ===== STORAGE KEYS =====
    const STORAGE_KEY = 'walabi_umowy';
    const CURRENT_KEY = 'walabi_umowa_current';

    // ===== FLATPICKR INIT =====
    flatpickr.localize(flatpickr.l10ns.pl);

    flatpickr("#contractDate", {
        dateFormat: "d.m.Y",
        defaultDate: new Date()
    });

    // ===== PRINT =====
    function printDoc() {
        window.print();
        toast('Otwarto okno drukowania');
    }

    // ===== EMAIL =====
    window.sendEmail = function() {
        const docNum = document.getElementById('docNumber').value || 'Umowa';
        const client = document.getElementById('clientName').value || '';
        const subject = encodeURIComponent(`WALABI - ${docNum}${client ? ' - ' + client : ''}`);
        const body = encodeURIComponent(`Dzie≈Ñ dobry,\n\nW za≈ÇƒÖczeniu przesy≈Çam ${docNum}.\n\nZ powa≈ºaniem,\nWALABI Sp. z o.o. Sp.k.`);
        window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
        toast('Otwarto klienta email');
    };

    // ===== WHATSAPP =====
    window.sendWhatsApp = function() {
        const docNum = document.getElementById('docNumber').value || 'Umowa';
        const client = document.getElementById('clientName').value || '';
        const text = encodeURIComponent(`Dzie≈Ñ dobry,\n\nW za≈ÇƒÖczeniu przesy≈Çam ${docNum}${client ? ' dla ' + client : ''} z WALABI.`);
        window.open(`https://wa.me/?text=${text}`, '_blank');
        toast('Otwarto WhatsApp');
    };

    // ===== CLEAR FORM =====
    function clearForm() {
        if (confirm('Czy na pewno chcesz wyczy≈õciƒá formularz?')) {
            document.querySelectorAll('input[type="text"]').forEach(input => {
                if (input.id !== 'contractPlace') {
                    input.value = '';
                }
            });
            document.getElementById('docNumber').value = 'P-XXX-26';
            flatpickr("#contractDate", {
                dateFormat: "d.m.Y",
                defaultDate: new Date()
            });
            toast('Formularz wyczyszczony');
        }
    }

    // ===== EXPORT DOCX =====
    async function exportDOCX() {
        toast('Generowanie DOCX...');

        const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;

        const docNum = document.getElementById('docNumber').value || 'P-XXX-26';
        const contractDate = document.getElementById('contractDate').value || '';
        const contractPlace = document.getElementById('contractPlace').value || 'Toruniu';
        const clientName = document.getElementById('clientName').value || '';
        const clientCity = document.getElementById('clientCity').value || '';
        const clientAddress = document.getElementById('clientAddress').value || '';
        const clientNIP = document.getElementById('clientNIP').value || '';
        const clientPhone = document.getElementById('clientPhone').value || '';
        const clientEmail = document.getElementById('clientEmail').value || '';
        const scopeOfWork = document.getElementById('scopeOfWork').value || 'produkcjƒô, dostawƒô i monta≈º';
        const furnitureType = document.getElementById('furnitureType').value || '';
        const installationAddress = document.getElementById('installationAddress').value || '';
        const termWeeksFrom = document.getElementById('termWeeksFrom').value || '';
        const termWeeksTo = document.getElementById('termWeeksTo').value || '';
        const priceNetto = document.getElementById('priceNetto').value || '';
        const priceVat = document.getElementById('priceVat').value || '';
        const priceBrutto = document.getElementById('priceBrutto').value || '';
        const priceBruttoWords = document.getElementById('priceBruttoWords').value || '';
        const payment1Percent = document.getElementById('payment1Percent').value || '50';
        const payment2Percent = document.getElementById('payment2Percent').value || '45';
        const payment3Percent = document.getElementById('payment3Percent').value || '5';
        const payment1Amount = document.getElementById('payment1Amount').value || '';
        const payment2Amount = document.getElementById('payment2Amount').value || '';
        const payment3Amount = document.getElementById('payment3Amount').value || '';
        const payment1Days = document.getElementById('payment1Days').value || '';
        const warrantyMonths = document.getElementById('warrantyMonths').value || '';

        const doc = new Document({
            sections: [{
                properties: {},
                children: [
                    new Paragraph({
                        children: [new TextRun({ text: `UMOWA Nr ${docNum}`, bold: true, size: 32 })],
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `zawarta w dniu ${contractDate} w ${contractPlace} pomiƒôdzy:`, size: 22 })],
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "WYKONAWCA:", bold: true, size: 22 })],
                        spacing: { before: 200, after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "WALABI Sp√≥≈ÇkƒÖ z ograniczonƒÖ odpowiedzialno≈õciƒÖ Sp√≥≈ÇkƒÖ komandytowƒÖ", bold: true, size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "z siedzibƒÖ w Toruniu, ul. Kosynier√≥w Ko≈õciuszkowskich 13/4, 87-100 Toru≈Ñ,", size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "KRS 0000725731, REGON: 369866245, NIP: 8792700696,", size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: 'zwanƒÖ dalej ‚ÄûWykonawcƒÖ",', size: 22 })],
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "a", size: 22 })],
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "ZAMAWIAJƒÑCY:", bold: true, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: clientName || "[Pe≈Çna Nazwa ZamawiajƒÖcego / Firma]", bold: true, size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `z siedzibƒÖ w ${clientCity || "[Miejscowo≈õƒá]"}, ${clientAddress || "[Adres]"}`, size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `NIP ${clientNIP || "[NIP]"}`, size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `tel.: ${clientPhone || "[Telefon]"}, e-mail: ${clientEmail || "[E-mail]"}`, size: 22 })],
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: 'zwanym dalej ‚ÄûZamawiajƒÖcym",', size: 22 })],
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: 'zwanymi ≈ÇƒÖcznie ‚ÄûStronami", a ka≈ºdy z osobna ‚ÄûStronƒÖ".', size: 22 })],
                        spacing: { after: 400 }
                    }),
                    // ¬ß1
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß1. PRZEDMIOT UMOWY", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `1. ZamawiajƒÖcy zleca, a Wykonawca przyjmuje do realizacji zam√≥wienie obejmujƒÖce ${scopeOfWork || "produkcjƒô, dostawƒô i monta≈º"} ${furnitureType || "[Opis Rodzaju Mebli]"} wed≈Çug specyfikacji stanowiƒÖcej Za≈ÇƒÖcznik nr 1 oraz projektu stanowiƒÖcego Za≈ÇƒÖcznik nr 2.`, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `2. Meble zostanƒÖ zamontowane w lokalizacji: ${installationAddress || "[Lokalizacja Monta≈ºu]"}`, size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß2
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß2. TERMINY REALIZACJI", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `1. Termin realizacji: ${termWeeksFrom || "[Liczba]"} do ${termWeeksTo || "[Liczba]"} tygodni od daty podpisania umowy.`, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "2. Przez realizacjƒô przedmiotu umowy rozumie siƒô wykonanie i monta≈º wszystkich Mebli wymienionych w Za≈ÇƒÖczniku nr 1.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß3
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß3. OBOWIƒÑZKI STRON", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "1. ZamawiajƒÖcy zobowiƒÖzuje siƒô do: umo≈ºliwienia pomiar√≥w, zapewnienia dostƒôpu, przygotowania miejsca monta≈ºu, zapewnienia medi√≥w, terminowej realizacji p≈Çatno≈õci, niezw≈Çocznego podejmowania decyzji, odbioru Mebli.", size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "2. Wykonawca zobowiƒÖzuje siƒô do: wykonania zgodnie ze specyfikacjƒÖ, dokonania pomiar√≥w, stosowania materia≈Ç√≥w zgodnych z normami, wykonania monta≈ºu z nale≈ºytƒÖ staranno≈õciƒÖ, usuniƒôcia odpad√≥w, wydania dokument√≥w gwarancyjnych.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß4
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß4. ODBI√ìR", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "Odbi√≥r przedmiotu umowy nastƒÖpi po zako≈Ñczeniu monta≈ºu Mebli, na podstawie protoko≈Çu odbioru podpisanego przez obie Strony.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß5
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß5. OSOBY KONTAKTOWE", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "Ze strony Wykonawcy: Leszek Borowski (501 260 990), Jaros≈Çaw R√≥≈ºa≈Ñski (501 266 670)", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß6 WYNAGRODZENIE
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß6. WYNAGRODZENIE I WARUNKI P≈ÅATNO≈öCI", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Warto≈õƒá netto: ${priceNetto || "[Kwota]"} z≈Ç`, size: 22 })],
                        spacing: { after: 50 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Podatek VAT (23%): ${priceVat || "[Kwota]"} z≈Ç`, size: 22 })],
                        spacing: { after: 50 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Warto≈õƒá brutto: ${priceBrutto || "[Kwota]"} z≈Ç (${priceBruttoWords || "[s≈Çownie]"})`, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Pierwsza p≈Çatno≈õƒá (${payment1Percent}%): ${payment1Amount || "[Kwota]"} z≈Ç brutto, p≈Çatna ${payment1Days || "[Liczba]"} dni po podpisaniu umowy`, size: 22 })],
                        spacing: { after: 50 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Druga p≈Çatno≈õƒá (${payment2Percent}%): ${payment2Amount || "[Kwota]"} z≈Ç brutto - przed dostawƒÖ`, size: 22 })],
                        spacing: { after: 50 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `Pozosta≈Ça kwota (${payment3Percent}%): ${payment3Amount || "[Kwota]"} z≈Ç brutto - po monta≈ºu i protokole odbioru`, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "Nr konta: mBank 48 1140 2004 0000 3602 7758 4396", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß7 GWARANCJA
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß7. GWARANCJA", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `1. Wykonawca udziela ${warrantyMonths || "[Liczba]"} miesiƒôcy gwarancji na wykonane Meble, liczonej od daty podpisania protoko≈Çu odbioru.`, size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "2. Szczeg√≥≈Çowe warunki gwarancji okre≈õla Za≈ÇƒÖcznik nr 3.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß8
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß8. ODSTƒÑPIENIE OD UMOWY", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "ZamawiajƒÖcy mo≈ºe odstƒÖpiƒá od umowy w przypadku op√≥≈∫nienia przekraczajƒÖcego 30 dni lub ra≈ºƒÖcego naruszenia umowy. Wykonawca mo≈ºe odstƒÖpiƒá w przypadku op√≥≈∫nienia p≈Çatno≈õci ponad 14 dni lub braku wsp√≥≈Çdzia≈Çania.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß9
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß9. OCHRONA DANYCH OSOBOWYCH", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "ZamawiajƒÖcy wyra≈ºa zgodƒô na przetwarzanie danych osobowych zgodnie z RODO. Administratorem jest WALABI Sp. z o.o. Sp.k.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß10
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß10. POSTANOWIENIA KO≈ÉCOWE", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "W sprawach nieuregulowanych zastosowanie majƒÖ przepisy KC. Zmiany wymagajƒÖ formy pisemnej. Spory rozstrzygane przez sƒÖd w≈Ça≈õciwy dla siedziby Wykonawcy.", size: 22 })],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "Za≈ÇƒÖczniki: 1) Specyfikacja mebli, 2) Projekt wykonawczy, 3) Zalecenia i warunki gwarancji.", size: 22 })],
                        spacing: { after: 200 }
                    }),
                    // ¬ß11
                    new Paragraph({
                        children: [new TextRun({ text: "¬ß11. WALORYZACJA", bold: true, size: 24 })],
                        spacing: { before: 300, after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: "W przypadku wzrostu cen materia≈Ç√≥w powy≈ºej 10%, Strony zobowiƒÖzujƒÖ siƒô do renegocjacji wynagrodzenia.", size: 22 })],
                        spacing: { after: 400 }
                    }),
                    // Signatures
                    new Paragraph({
                        children: [
                            new TextRun({ text: "______________________", size: 22 }),
                            new TextRun({ text: "                                        ", size: 22 }),
                            new TextRun({ text: "______________________", size: 22 })
                        ],
                        spacing: { before: 600 }
                    }),
                    new Paragraph({
                        children: [
                            new TextRun({ text: "        Wykonawca        ", size: 20 }),
                            new TextRun({ text: "                                                    ", size: 20 }),
                            new TextRun({ text: "        ZamawiajƒÖcy        ", size: 20 })
                        ]
                    })
                ]
            }]
        });

        const blob = await Packer.toBlob(doc);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Umowa_${docNum.replace(/\//g, '-')}_${clientName || 'WALABI'}.docx`;
        a.click();
        URL.revokeObjectURL(url);

        toast('Pobrano plik DOCX', 'success');
    }

    // ===== TOAST =====
    function toast(msg, type) {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.className = 'toast show' + (type ? ' ' + type : '');
        setTimeout(() => el.className = 'toast', 3000);
    }

    // ===== FORMATOWANIE KWOT =====
    function formatCurrency(value) {
        // Formatuj z spacjƒÖ jako separatorem tysiƒôcy
        const parts = value.toFixed(2).split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        return parts.join(',');
    }

    function parseNumber(str) {
        if (!str) return 0;
        // Usu≈Ñ spacje i zamie≈Ñ przecinek na kropkƒô
        return parseFloat(str.replace(/\s/g, '').replace(',', '.')) || 0;
    }

    // ===== KWOTA S≈ÅOWNIE =====
    function numberToWords(num) {
        const ones = ['', 'jeden', 'dwa', 'trzy', 'cztery', 'piƒôƒá', 'sze≈õƒá', 'siedem', 'osiem', 'dziewiƒôƒá'];
        const teens = ['dziesiƒôƒá', 'jedena≈õcie', 'dwana≈õcie', 'trzyna≈õcie', 'czterna≈õcie', 'piƒôtna≈õcie', 'szesna≈õcie', 'siedemna≈õcie', 'osiemna≈õcie', 'dziewiƒôtna≈õcie'];
        const tens = ['', 'dziesiƒôƒá', 'dwadzie≈õcia', 'trzydzie≈õci', 'czterdzie≈õci', 'piƒôƒádziesiƒÖt', 'sze≈õƒádziesiƒÖt', 'siedemdziesiƒÖt', 'osiemdziesiƒÖt', 'dziewiƒôƒádziesiƒÖt'];
        const hundreds = ['', 'sto', 'dwie≈õcie', 'trzysta', 'czterysta', 'piƒôƒáset', 'sze≈õƒáset', 'siedemset', 'osiemset', 'dziewiƒôƒáset'];

        function getThousandForm(n) {
            if (n === 1) return 'tysiƒÖc';
            if (n >= 2 && n <= 4) return 'tysiƒÖce';
            if (n >= 5 && n <= 21) return 'tysiƒôcy';
            const lastDigit = n % 10;
            if (lastDigit >= 2 && lastDigit <= 4) return 'tysiƒÖce';
            return 'tysiƒôcy';
        }

        function getMillionForm(n) {
            if (n === 1) return 'milion';
            if (n >= 2 && n <= 4) return 'miliony';
            if (n >= 5 && n <= 21) return 'milion√≥w';
            const lastDigit = n % 10;
            if (lastDigit >= 2 && lastDigit <= 4) return 'miliony';
            return 'milion√≥w';
        }

        function convertHundreds(n) {
            if (n === 0) return '';
            let result = '';
            const h = Math.floor(n / 100);
            const remainder = n % 100;
            if (h > 0) result += hundreds[h] + ' ';
            if (remainder >= 10 && remainder < 20) {
                result += teens[remainder - 10];
            } else {
                const t = Math.floor(remainder / 10);
                const o = remainder % 10;
                if (t > 0) result += tens[t] + ' ';
                if (o > 0) result += ones[o];
            }
            return result.trim();
        }

        if (num === 0) return 'zero';

        const intPart = Math.floor(num);
        const grosze = Math.round((num - intPart) * 100);

        let result = '';

        // Miliony
        const millions = Math.floor(intPart / 1000000);
        if (millions > 0) {
            result += convertHundreds(millions) + ' ' + getMillionForm(millions) + ' ';
        }

        // TysiƒÖce
        const thousands = Math.floor((intPart % 1000000) / 1000);
        if (thousands > 0) {
            result += convertHundreds(thousands) + ' ' + getThousandForm(thousands) + ' ';
        }

        // Setki, dziesiƒÖtki, jedno≈õci
        const rest = intPart % 1000;
        if (rest > 0) {
            result += convertHundreds(rest);
        }

        result = result.trim();

        // Dodaj grosze
        if (grosze > 0) {
            result += ' ' + grosze.toString().padStart(2, '0') + '/100';
        }

        return result;
    }

    // ===== AUTO-RESIZE INPUT =====
    function autoResizeInput(input) {
        // Tworzymy tymczasowy span do pomiaru szeroko≈õci tekstu
        const span = document.createElement('span');
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'nowrap';
        span.style.font = window.getComputedStyle(input).font;
        span.textContent = input.value || input.placeholder;
        document.body.appendChild(span);

        const width = span.offsetWidth + 20; // dodaj margines
        input.style.width = Math.max(width, 180) + 'px';

        document.body.removeChild(span);
    }

    // ===== PRZELICZANIE KWOT =====
    function calculatePrices() {
        const netto = parseNumber(document.getElementById('priceNetto').value);
        const payment1Percent = parseNumber(document.getElementById('payment1Percent').value) || 50;
        const payment2Percent = parseNumber(document.getElementById('payment2Percent').value) || 45;

        if (netto > 0) {
            // Oblicz VAT i brutto
            const vat = netto * 0.23;
            const brutto = netto * 1.23;

            document.getElementById('priceVat').value = formatCurrency(vat);
            document.getElementById('priceBrutto').value = formatCurrency(brutto);

            // S≈Çownie brutto
            const bruttoWordsEl = document.getElementById('priceBruttoWords');
            bruttoWordsEl.value = numberToWords(brutto);
            autoResizeInput(bruttoWordsEl);

            // Oblicz transze p≈Çatno≈õci
            const payment3Percent = 100 - payment1Percent - payment2Percent;
            document.getElementById('payment3Percent').value = payment3Percent;

            const payment1Amount = brutto * (payment1Percent / 100);
            const payment2Amount = brutto * (payment2Percent / 100);
            const payment3Amount = brutto * (payment3Percent / 100);

            document.getElementById('payment1Amount').value = formatCurrency(payment1Amount);
            document.getElementById('payment2Amount').value = formatCurrency(payment2Amount);
            document.getElementById('payment3Amount').value = formatCurrency(payment3Amount);

            // Aktualizuj za≈ÇƒÖcznik nr 1 - podsumowanie koszt√≥w
            document.getElementById('sumNettoSpec').textContent = formatCurrency(netto);
            document.getElementById('sumVatSpec').textContent = formatCurrency(vat);
            document.getElementById('sumBruttoSpec').textContent = formatCurrency(brutto);

            // Aktualizuj harmonogram p≈Çatno≈õci w za≈ÇƒÖczniku
            document.getElementById('harmPercent1').textContent = payment1Percent;
            document.getElementById('harmPercent2').textContent = payment2Percent;
            document.getElementById('harmPercent3').textContent = payment3Percent;
            document.getElementById('harmAmount1').textContent = formatCurrency(payment1Amount);
            document.getElementById('harmAmount2').textContent = formatCurrency(payment2Amount);
            document.getElementById('harmAmount3').textContent = formatCurrency(payment3Amount);
        }
    }

    // ===== SYNCHRONIZACJA NUMER√ìW DOKUMENTU =====
    function syncDocNumbers() {
        const docNum = document.getElementById('docNumber').value || 'P-XXX-26';
        const date = document.getElementById('contractDate').value || '';

        // Aktualizuj numery w za≈ÇƒÖcznikach
        document.getElementById('attachDocNum1').textContent = docNum;
        document.getElementById('attachDocNum1b').textContent = docNum;
        document.getElementById('attachDocNum3').textContent = docNum;
        document.getElementById('attachDocNum3b').textContent = docNum;
        document.getElementById('attachDate3').textContent = date;
    }

    // ===== SET DEFAULT DATE =====
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const formattedDate = today.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit', year: 'numeric' });
        document.getElementById('contractDate').value = formattedDate;

        // Dodaj event listenery do p√≥l z kwotami
        document.getElementById('priceNetto').addEventListener('input', calculatePrices);
        document.getElementById('priceNetto').addEventListener('blur', function() {
            const val = parseNumber(this.value);
            if (val > 0) this.value = formatCurrency(val);
        });

        document.getElementById('payment1Percent').addEventListener('input', calculatePrices);
        document.getElementById('payment2Percent').addEventListener('input', calculatePrices);

        // Auto-resize dla p√≥l tekstowych
        const furnitureTypeEl = document.getElementById('furnitureType');
        furnitureTypeEl.addEventListener('input', function() {
            autoResizeInput(this);
        });

        const installationAddressEl = document.getElementById('installationAddress');
        installationAddressEl.addEventListener('input', function() {
            autoResizeInput(this);
        });

        // Synchronizacja numer√≥w dokumentu
        document.getElementById('docNumber').addEventListener('input', syncDocNumbers);
        document.getElementById('contractDate').addEventListener('change', syncDocNumbers);

        // Synchronizuj specyfikacjƒô z furnitureType
        document.getElementById('furnitureType').addEventListener('input', function() {
            document.getElementById('spec1Desc').value = this.value;
        });

        // Wczytaj historiƒô przy starcie
        renderHistory();
        syncDocNumbers();
    });

    // ===== SERIALIZATION =====
    function collectFormData() {
        const data = { fields: {}, specRowCount: specRowCount };
        document.querySelectorAll('.document input, .document textarea').forEach(el => {
            if (!el.id) return;
            data.fields[el.id] = el.value;
        });
        return data;
    }

    function restoreFormData(data) {
        // Odtw√≥rz wiersze specyfikacji
        if (data.specRowCount) {
            specRowCount = data.specRowCount;
            buildSpecRows(specRowCount);
        }

        // Przywr√≥ƒá warto≈õci p√≥l
        Object.keys(data.fields).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = data.fields[id];
        });

        // Przelicz ceny i dopasuj szeroko≈õci p√≥l
        calculateSpecTotals();
        calculatePrices();
        syncDocNumbers();
        autoResizeInput(document.getElementById('furnitureType'));
        autoResizeInput(document.getElementById('installationAddress'));
        autoResizeInput(document.getElementById('priceBruttoWords'));
    }

    // ===== STORAGE =====
    function loadAllDocs() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        } catch { return []; }
    }

    function saveAllDocs(docs) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(docs));
    }

    window.saveDocument = function() {
        const data = collectFormData();
        const docNum = document.getElementById('docNumber').value || 'P-XXX-26';
        const client = document.getElementById('clientName').value || 'Brak klienta';
        const date = document.getElementById('contractDate').value || '';
        const total = document.getElementById('priceBrutto').value || '';

        const doc = {
            id: Date.now(),
            number: docNum,
            client: client,
            date: date,
            total: total,
            data: data
        };

        const docs = loadAllDocs();
        const currentId = parseInt(localStorage.getItem(CURRENT_KEY));
        const existingIdx = docs.findIndex(d => d.id === currentId);

        if (existingIdx >= 0) {
            docs[existingIdx] = { ...docs[existingIdx], number: doc.number, client: doc.client, date: doc.date, total: doc.total, data: doc.data };
        } else {
            docs.push(doc);
            localStorage.setItem(CURRENT_KEY, doc.id);
        }

        saveAllDocs(docs);
        renderHistory();
        toast('Dokument zapisany', 'success');
    };

    window.loadDocument = function(id) {
        const docs = loadAllDocs();
        const doc = docs.find(d => d.id === id);
        if (!doc) return;
        restoreFormData(doc.data);
        localStorage.setItem(CURRENT_KEY, id);
        toast('Wczytano: ' + doc.number);
    };

    window.deleteDocument = function(id, e) {
        e.stopPropagation();
        if (!confirm('UsunƒÖƒá ten dokument z historii?')) return;
        let docs = loadAllDocs();
        docs = docs.filter(d => d.id !== id);
        saveAllDocs(docs);
        renderHistory();
        toast('Dokument usuniƒôty');
    };

    // ===== HISTORY =====
    function renderHistory() {
        const docs = loadAllDocs();
        const container = document.getElementById('historyList');

        if (!docs.length) {
            container.innerHTML = '<div class="history-empty">Brak zapisanych dokument√≥w</div>';
            return;
        }

        container.innerHTML = docs.map(doc => `
            <div class="history-item" onclick="loadDocument(${doc.id})">
                <div>
                    <div class="hi-number">${doc.number}</div>
                    <div class="hi-client">${doc.client} | ${doc.total} PLN</div>
                </div>
                <button class="hi-delete" onclick="deleteDocument(${doc.id}, event)" title="Usu≈Ñ">&times;</button>
            </div>
        `).reverse().join('');
    }

    // ===== NEW DOCUMENT =====
    window.newDocument = function() {
        if (!confirm('RozpoczƒÖƒá nowy dokument? Niezapisane dane zostanƒÖ utracone.')) return;
        document.querySelectorAll('.document input, .document textarea').forEach(el => {
            if (el.id !== 'contractPlace') {
                el.value = '';
            }
        });
        document.getElementById('docNumber').value = 'P-XXX-26';
        const today = new Date();
        const formattedDate = today.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit', year: 'numeric' });
        document.getElementById('contractDate').value = formattedDate;
        // Reset specyfikacji do 1 wiersza
        specRowCount = 1;
        buildSpecRows(1);
        localStorage.removeItem(CURRENT_KEY);
        syncDocNumbers();
        toast('Nowy dokument');
    };

    // ===== AUTO RESIZE TEXTAREA =====
    window.autoResizeTextarea = function(textarea) {
        textarea.style.height = '18px';
        if (textarea.scrollHeight > 18) {
            textarea.style.height = textarea.scrollHeight + 'px';
        }
    };

    // ===== SPECYFIKACJA MEBLI - WIERSZE =====
    let specRowCount = 1;

    function buildSpecRows(count) {
        const tbody = document.getElementById('specTableBody');
        tbody.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            tbody.innerHTML += createSpecRow(i);
        }
        // Dodaj event listenery do nowych p√≥l
        attachSpecRowListeners();
    }

    function createSpecRow(num) {
        return `
            <tr data-row="${num}">
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; vertical-align: top;">${num}</td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: left; vertical-align: top;"><textarea id="spec${num}Desc" placeholder="Opis mebla" style="border:none;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);text-align:left;resize:none;overflow:hidden;line-height:18px;height:18px;word-wrap:break-word;white-space:pre-wrap;margin:0;padding:0;display:block;box-sizing:border-box;" oninput="autoResizeTextarea(this)"></textarea></td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; vertical-align: top;"><input type="text" id="spec${num}Dim" placeholder="-" style="border:none;text-align:center;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);"></td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; vertical-align: top;"><input type="text" id="spec${num}Qty" value="1" style="border:none;text-align:center;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);"></td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: center; vertical-align: top;"><input type="text" id="spec${num}Unit" value="kpl" style="border:none;text-align:center;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);"></td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: right; vertical-align: top;"><input type="text" id="spec${num}Price" placeholder="0,00" style="border:none;text-align:right;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);" onblur="formatSpecPrice(this)"></td>
                <td style="border: 0.5pt solid var(--color-border); padding: 3px 6px; text-align: right; vertical-align: top;"><input type="text" id="spec${num}Total" placeholder="0,00" style="border:none;text-align:right;width:100%;font-family:var(--font-primary);font-size:var(--font-size-data);font-weight:var(--font-weight-data);" readonly></td>
            </tr>
        `;
    }

    function attachSpecRowListeners() {
        for (let i = 1; i <= specRowCount; i++) {
            const qtyEl = document.getElementById(`spec${i}Qty`);
            const priceEl = document.getElementById(`spec${i}Price`);
            if (qtyEl) {
                qtyEl.addEventListener('input', () => calculateSpecRow(i));
            }
            if (priceEl) {
                priceEl.addEventListener('input', () => calculateSpecRow(i));
                priceEl.addEventListener('blur', function() {
                    const val = parseNumber(this.value);
                    if (val > 0) this.value = formatCurrency(val);
                });
            }
        }
    }

    function calculateSpecRow(num) {
        const qtyEl = document.getElementById(`spec${num}Qty`);
        const priceEl = document.getElementById(`spec${num}Price`);
        const qty = parseNumber(qtyEl.value) || 1;
        const price = parseNumber(priceEl.value) || 0;
        const total = qty * price;
        document.getElementById(`spec${num}Total`).value = formatCurrency(total);
        calculateSpecTotals();
    }

    function formatSpecPrice(input) {
        const price = parseNumber(input.value) || 0;
        if (price > 0) {
            input.value = formatCurrency(price);
        }
    }

    function calculateSpecTotals() {
        let sumMebli = 0;
        for (let i = 1; i <= specRowCount; i++) {
            const totalEl = document.getElementById(`spec${i}Total`);
            if (totalEl) {
                sumMebli += parseNumber(totalEl.value) || 0;
            }
        }

        const dodatkowe = parseNumber(document.getElementById('sumDodatkowe').value) || 0;
        const transport = parseNumber(document.getElementById('sumTransport').value) || 0;
        const montaz = parseNumber(document.getElementById('sumMontaz').value) || 0;

        const netto = sumMebli + dodatkowe + transport + montaz;
        const vat = netto * 0.23;
        const brutto = netto + vat;

        document.getElementById('sumMebli').textContent = formatCurrency(sumMebli);
        document.getElementById('sumNettoSpec').textContent = formatCurrency(netto);
        document.getElementById('sumVatSpec').textContent = formatCurrency(vat);
        document.getElementById('sumBruttoSpec').textContent = formatCurrency(brutto);

        // Aktualizuj g≈Ç√≥wne pole priceNetto je≈õli puste lub zsynchronizowane
        const priceNettoEl = document.getElementById('priceNetto');
        if (!priceNettoEl.value || priceNettoEl.dataset.synced === 'true') {
            priceNettoEl.value = formatCurrency(netto);
            priceNettoEl.dataset.synced = 'true';
            calculatePrices();
        }
    }

    window.addSpecRow = function() {
        specRowCount++;
        const rowNum = specRowCount; // zachowaj numer wiersza
        const tbody = document.getElementById('specTableBody');
        tbody.insertAdjacentHTML('beforeend', createSpecRow(rowNum));
        // Dodaj listenery tylko do nowego wiersza
        const qtyEl = document.getElementById(`spec${rowNum}Qty`);
        const priceEl = document.getElementById(`spec${rowNum}Price`);
        if (qtyEl) qtyEl.addEventListener('input', () => calculateSpecRow(rowNum));
        if (priceEl) {
            priceEl.addEventListener('input', () => calculateSpecRow(rowNum));
            priceEl.addEventListener('blur', function() {
                const val = parseNumber(this.value);
                if (val > 0) this.value = formatCurrency(val);
            });
        }
        toast('Dodano wiersz ' + specRowCount);
    };

    window.removeSpecRow = function() {
        if (specRowCount <= 1) {
            toast('Musi pozostaƒá minimum 1 wiersz', 'error');
            return;
        }
        const tbody = document.getElementById('specTableBody');
        const lastRow = tbody.querySelector(`tr[data-row="${specRowCount}"]`);
        if (lastRow) {
            lastRow.remove();
            specRowCount--;
            calculateSpecTotals();
            toast('Usuniƒôto wiersz');
        }
    };

    // Inicjalizacja tabeli specyfikacji przy starcie
    document.addEventListener('DOMContentLoaded', function() {
        // Buduj tabelƒô specyfikacji
        buildSpecRows(1);

        // Event listenery dla p√≥l koszt√≥w dodatkowych
        document.getElementById('sumDodatkowe').addEventListener('input', calculateSpecTotals);
        document.getElementById('sumTransport').addEventListener('input', calculateSpecTotals);
        document.getElementById('sumMontaz').addEventListener('input', calculateSpecTotals);

        // Odznacz synchronizacjƒô gdy u≈ºytkownik rƒôcznie zmieni priceNetto
        document.getElementById('priceNetto').addEventListener('focus', function() {
            this.dataset.synced = 'false';
        });
    });
</script>

</body>
</html>
