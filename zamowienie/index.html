<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zam√≥wienie - WALABI</title>
    <!-- Google Fonts - Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* ===== QUIET LUXURY 2026 DESIGN SYSTEM ===== */
        :root {
            --color-primary: #2D2E2E;
            --color-secondary: #757575;
            --color-border: #E0E0E0;
            --color-background: #FAFAFA;
            --color-white: #FFFFFF;
            --color-highlight: #F7F5F0;
            --color-accent: #2D2E2E;

            --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;

            /* Typography - Labels */
            --font-size-label: 7pt;
            --font-weight-label: 500;
            --color-label: #757575;
            --letter-spacing-label: 0.08em;

            /* Typography - Data */
            --font-size-data: 9pt;
            --font-weight-data: 600;
            --color-data: #2D2E2E;

            /* Typography - Other */
            --font-size-xs: 6.5pt;
            --font-size-sm: 8pt;
            --font-size-base: 9pt;
            --font-size-lg: 10pt;
            --font-size-xl: 12pt;
            --font-size-title: 14pt;

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 6px;
            --spacing-md: 10px;
            --spacing-lg: 14px;
            --spacing-xl: 18px;

            --line-height: 1.3;
        }

        /* Flatpickr customization */
        .flatpickr-calendar {
            font-family: var(--font-primary) !important;
            font-size: 12px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,.15) !important;
            border: 1px solid var(--color-border) !important;
        }
        .flatpickr-day.selected, .flatpickr-day.selected:hover {
            background: var(--color-primary) !important;
            border-color: var(--color-primary) !important;
        }
        .flatpickr-day:hover {
            background: var(--color-highlight) !important;
        }

        /* ===== RESET & BASE ===== */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            line-height: var(--line-height);
            background: #E8E8E8;
            color: var(--color-primary);
            font-weight: 400;
        }

        /* ===== LAYOUT ===== */
        .app-wrapper {
            display: flex;
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 24px;
            align-self: flex-start;
        }

        .sidebar-card {
            background: var(--color-white);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,.08);
            border: 1px solid var(--color-border);
        }

        .sidebar-card h3 {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar .logo-area {
            text-align: center;
            padding: 12px 0;
        }

        .sidebar .logo-area img {
            max-width: 100px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 10px 14px;
            margin-bottom: 6px;
            font-size: 11px;
            font-weight: 600;
            font-family: var(--font-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            transition: all .2s ease;
            letter-spacing: 0.02em;
        }

        .btn:active { transform: scale(.98); }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-white);
        }
        .btn-primary:hover { background: #1a1a1a; }

        .btn-secondary {
            background: var(--color-background);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
        }
        .btn-secondary:hover { background: var(--color-highlight); }

        .btn-danger {
            background: var(--color-white);
            color: #B71C1C;
            border: 1px solid var(--color-border);
        }
        .btn-danger:hover { background: #FFF5F5; }

        /* Historia */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            font-size: 11px;
        }

        .history-item {
            padding: 8px 10px;
            border-bottom: 1px solid var(--color-border);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background .2s;
        }

        .history-item:hover { background: var(--color-highlight); }

        .history-item .hi-number {
            font-weight: 600;
            color: var(--color-primary);
        }
        .history-item .hi-client {
            color: var(--color-secondary);
            font-size: 10px;
        }
        .history-item .hi-delete {
            color: #B71C1C;
            cursor: pointer;
            font-size: 14px;
            padding: 0 4px;
            border: none;
            background: none;
            opacity: 0.6;
            transition: opacity .2s;
        }
        .history-item .hi-delete:hover { opacity: 1; }

        .history-empty {
            color: var(--color-secondary);
            font-style: italic;
            padding: 12px;
            text-align: center;
            font-size: 11px;
        }

        /* ===== DOKUMENT ===== */
        .page-container {
            flex: 1;
            min-width: 0;
        }

        .document {
            width: 210mm;
            min-height: 297mm;
            padding: 10mm 14mm;
            background: var(--color-white);
            box-shadow: 0 2px 12px rgba(0,0,0,.1);
            position: relative;
        }

        /* --- Nag≈Ç√≥wek z logo --- */
        .doc-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--color-border);
        }

        .doc-header .logo img {
            height: 45px;
        }

        .doc-header .company-info {
            text-align: right;
        }

        .doc-header .company-info .name {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--color-primary);
            letter-spacing: 0.02em;
        }

        .doc-header .company-info .tagline {
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
            margin-top: 2px;
            letter-spacing: 0.03em;
        }

        .doc-header .company-info .contact {
            font-size: var(--font-size-xs);
            color: var(--color-secondary);
            margin-top: 4px;
        }

        /* --- Tytu≈Ç dokumentu --- */
        .doc-title {
            text-align: center;
            font-size: var(--font-size-title);
            font-weight: 700;
            margin: 14px 0;
            padding: 12px 0;
            border-top: 2px solid var(--color-primary);
            border-bottom: 2px solid var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
        }

        /* --- Meta dokumentu --- */
        .doc-meta {
            display: flex;
            gap: 24px;
            margin-bottom: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .doc-meta-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .doc-meta-row .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
        }

        /* --- Sekcje --- */
        .doc-section {
            margin-bottom: 12px;
        }

        .doc-section-title {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--color-border);
        }

        .doc-hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 12px 0;
        }

        /* --- Inputy w dokumencie --- */
        .doc-field {
            border: none;
            border-bottom: 1px solid var(--color-border);
            padding: 2px 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            transition: all .2s;
        }

        .doc-field:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
            background: var(--color-highlight);
        }

        .doc-field::placeholder {
            color: #BDBDBD;
            font-weight: 400;
        }

        .w50  { width: 50px; }
        .w70  { width: 70px; }
        .w100 { width: 100px; }
        .w120 { width: 120px; }
        .w150 { width: 150px; }
        .w200 { width: 200px; }
        .w250 { width: 250px; }
        .w-full { width: 100%; }

        /* --- Rows --- */
        .doc-row {
            display: flex;
            flex-wrap: wrap;
            gap: 4px 12px;
            align-items: baseline;
            margin-bottom: 6px;
        }

        .doc-row .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
        }

        .doc-sep { color: var(--color-border); }

        /* --- Status badge --- */
        .status-select {
            padding: 6px 12px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            cursor: pointer;
            background: var(--color-white);
            color: var(--color-data);
            transition: all .2s;
        }

        .status-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        /* --- Tabela produkt√≥w --- */
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: var(--font-size-sm);
        }

        .products-table th {
            background: var(--color-primary);
            color: var(--color-white);
            padding: 6px 5px;
            font-weight: 600;
            font-size: var(--font-size-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            text-align: left;
            white-space: nowrap;
        }

        .products-table th:first-child { text-align: center; width: 22px; }

        .products-table td {
            border: 1px solid var(--color-border);
            padding: 3px 4px;
            height: 22px;
        }

        .products-table td:first-child {
            text-align: center;
            font-weight: 600;
            background: var(--color-background);
            width: 22px;
            color: var(--color-primary);
        }

        .products-table .col-name { width: 22%; }
        .products-table .col-desc { width: 26%; }
        .products-table .col-qty  { width: 8%; }
        .products-table .col-unit { width: 52px; }
        .products-table .col-price { width: 12%; }
        .products-table .col-vat  { width: 52px; }
        .products-table .col-total { width: 14%; text-align: right; }

        .products-table input,
        .products-table select {
            width: 100%;
            border: none;
            padding: 2px 3px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            background: transparent;
            color: var(--color-data);
            /* Hide dropdown arrows */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .products-table select::-ms-expand {
            display: none;
        }

        .products-table select:hover,
        .products-table select:focus {
            text-decoration: underline;
        }

        .products-table input:focus,
        .products-table select:focus {
            outline: none;
            background: var(--color-highlight);
        }

        .products-table input[type="number"] {
            -moz-appearance: textfield;
        }
        .products-table input[type="number"]::-webkit-inner-spin-button,
        .products-table input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
        }

        .products-table .sum-row td {
            background: var(--color-background);
            font-weight: 600;
            border-top: 2px solid var(--color-primary);
        }

        .products-table .line-total {
            text-align: right;
            font-weight: 600;
            padding-right: 6px;
            color: var(--color-data);
        }

        /* --- Podsumowanie --- */
        .totals-box {
            display: flex;
            justify-content: flex-end;
            margin: 10px 0;
        }

        .totals-table {
            width: 240px;
            font-size: var(--font-size-base);
            border-collapse: collapse;
        }

        .totals-table td {
            padding: 6px 10px;
            border: 1px solid var(--color-border);
        }

        .totals-table td:first-child {
            background: var(--color-background);
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
        }

        .totals-table td:last-child {
            text-align: right;
            font-weight: var(--font-weight-data);
            color: var(--color-data);
            white-space: nowrap;
        }

        .totals-table tr:last-child td {
            background: var(--color-primary);
            color: var(--color-white);
            font-size: var(--font-size-label);
        }

        .totals-table tr:last-child td:first-child {
            background: var(--color-primary);
            color: var(--color-white);
        }

        /* --- Warunki --- */
        .terms-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .term-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .term-row .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            min-width: 70px;
        }

        .term-row select,
        .term-row input {
            flex: 1;
            padding: 4px 8px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            color: var(--color-data);
        }

        .term-row select:focus,
        .term-row input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        /* --- O≈õwiadczenie --- */
        .statement-box {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            padding: 10px 12px;
            margin: 12px 0;
            font-size: var(--font-size-sm);
        }

        .statement-box p {
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .statement-box p b {
            font-size: var(--font-size-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
        }

        .checkbox-row {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 6px;
        }

        .checkbox-row input[type="checkbox"] {
            margin-top: 2px;
            accent-color: var(--color-primary);
        }

        .checkbox-row label {
            font-size: var(--font-size-sm);
            color: var(--color-secondary);
        }

        /* --- Podpisy --- */
        .signatures-section {
            margin-top: 16px;
        }

        .signatures-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 10px;
        }

        .signature-box h4 {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--color-border);
        }

        .signature-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 8px;
        }

        .signature-row label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-label);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-label);
            color: var(--color-label);
            min-width: 65px;
        }

        .signature-row input {
            flex: 1;
            border: none;
            border-bottom: 1px solid var(--color-border);
            padding: 2px 4px;
            font-size: var(--font-size-data);
            font-weight: var(--font-weight-data);
            font-family: var(--font-primary);
            color: var(--color-data);
            background: transparent;
        }

        .signature-row input:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
            background: var(--color-highlight);
        }

        .signature-line {
            flex: 1;
            border-bottom: 1px solid var(--color-border);
            min-height: 26px;
        }

        /* --- Stopka --- */
        .doc-footer {
            margin-top: 16px;
            font-size: var(--font-size-xs);
            color: var(--color-primary);
            text-align: center;
            border-top: 1px solid var(--color-border);
            padding-top: 8px;
            letter-spacing: 0.03em;
        }

        /* ===== DRUK ===== */
        @media print {
            html, body {
                background: var(--color-white);
                margin: 0;
                padding: 0;
            }

            .sidebar, .no-print { display: none !important; }

            .app-wrapper {
                padding: 0;
                margin: 0;
            }

            .document {
                box-shadow: none;
                padding: 6mm 10mm;
                width: 210mm;
                min-height: 296mm;
            }

            .doc-field, .products-table input, .products-table select,
            .signature-row input, .term-row input, .term-row select {
                border-color: transparent !important;
                background: transparent !important;
            }

            input[type="checkbox"] {
                -webkit-appearance: checkbox;
                appearance: checkbox;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            .products-table th, .doc-title, .totals-table tr:last-child td {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            .products-table .sum-row td,
            .products-table td:first-child,
            .doc-section-title,
            .totals-table td:first-child {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            @page {
                size: A4;
                margin: 5mm;
            }
        }

        /* ===== RESPONSIVE ===== */
        @media screen and (max-width: 900px) {
            .app-wrapper {
                flex-direction: column;
                padding: 12px;
            }
            .sidebar {
                width: 100%;
                position: static;
            }
            .document {
                width: 100%;
                min-height: auto;
                padding: 16px;
            }
            .terms-grid {
                grid-template-columns: 1fr;
            }
            .signatures-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: 6px;
            font-size: 12px;
            font-family: var(--font-primary);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all .3s ease;
            z-index: 999;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { background: #2E7D32; }
        .toast.error { background: #C62828; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <!-- ===== PANEL BOCZNY ===== -->
    <aside class="sidebar no-print">
        <div class="sidebar-card logo-area">
            <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:22px;font-weight:700;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI<div style=&quot;font-size:8px;color:#757575;font-weight:400;margin-top:2px&quot;>Sp. z o.o. Sp.k.</div></div>'">
        </div>

        <div class="sidebar-card">
            <h3>Akcje</h3>
            <a href="../index.html" class="btn btn-secondary" style="text-decoration:none;margin-bottom:12px;">‚Üê Strona g≈Ç√≥wna</a>
            <button class="btn btn-primary" onclick="printDoc()">Drukuj / Zapisz PDF</button>
            <button class="btn btn-secondary" onclick="sendEmail()">‚úâ Wy≈õlij mailem</button>
            <button class="btn btn-secondary" onclick="sendWhatsApp()">üí¨ Wy≈õlij WhatsApp</button>
            <button class="btn btn-secondary" onclick="saveDocument()">Zapisz dokument</button>
            <button class="btn btn-secondary" onclick="newDocument()">Nowy dokument</button>
            <button class="btn btn-danger" onclick="clearForm()">Wyczy≈õƒá formularz</button>
            <hr style="margin:12px 0;border:none;border-top:1px solid #ddd;">
            <button class="btn btn-secondary" onclick="exportToJSON()">üì• Eksportuj dane (JSON)</button>
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importuj dane (JSON)</button>
            <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importFromJSON(event)">
        </div>

        <div class="sidebar-card">
            <h3>Pozycje zam√≥wienia</h3>
            <div style="display:flex;gap:6px;">
                <button class="btn btn-secondary" onclick="addRow()" style="flex:1;text-align:center;">+ Dodaj</button>
                <button class="btn btn-secondary" onclick="removeRow()" style="flex:1;text-align:center;">- Usu≈Ñ</button>
            </div>
        </div>

        <div class="sidebar-card">
            <h3>Historia dokument√≥w</h3>
            <div id="historyList" class="history-list">
                <div class="history-empty">Brak zapisanych dokument√≥w</div>
            </div>
        </div>
    </aside>

    <!-- ===== DOKUMENT ===== -->
    <main class="page-container">
        <div class="document" id="document">

            <!-- Nag≈Ç√≥wek -->
            <div class="doc-header">
                <div class="logo">
                    <img src="../list-przewozowy/logo.png" alt="WALABI" onerror="this.outerHTML='<div style=&quot;font-size:20px;font-weight:700;color:#2D2E2E;letter-spacing:0.05em&quot;>WALABI</div>'">
                </div>
                <div class="company-info">
                    <div class="name">WALABI sp. z o.o. sp.k.</div>
                    <div class="tagline">Produkcja ¬∑ Dostawa ¬∑ Monta≈º mebli na zam√≥wienie</div>
                    <div class="contact">poczta@walabi.pl ¬∑ www.walabi.pl</div>
                </div>
            </div>

            <!-- Tytu≈Ç -->
            <div class="doc-title">Zam√≥wienie</div>

            <!-- Meta dokumentu -->
            <div class="doc-meta">
                <div class="doc-meta-row">
                    <span class="label">Nr zam√≥wienia</span>
                    <input type="text" class="doc-field w150" id="orderNumber" placeholder="">
                </div>
                <div class="doc-meta-row">
                    <span class="label">Data</span>
                    <input type="text" class="doc-field w100" id="orderDate" placeholder="">
                </div>
                <div class="doc-meta-row">
                    <span class="label">Status</span>
                    <select class="status-select" id="orderStatus">
                        <option value="new">Nowe</option>
                        <option value="confirmed">Potwierdzone</option>
                        <option value="in-progress">W realizacji</option>
                        <option value="completed">Zrealizowane</option>
                        <option value="cancelled">Anulowane</option>
                    </select>
                </div>
            </div>

            <hr class="doc-hr">

            <!-- Dane ZamawiajƒÖcego -->
            <div class="doc-section">
                <div class="doc-section-title">Dane ZamawiajƒÖcego</div>
                <div class="doc-row">
                    <span class="label">Nazwa / Imiƒô i nazwisko</span>
                    <input type="text" class="doc-field w250" id="clientName" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">NIP</span>
                    <input type="text" class="doc-field w120" id="clientNip" placeholder="">
                </div>
                <div class="doc-row">
                    <span class="label">Adres</span>
                    <input type="text" class="doc-field w200" id="clientAddress" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Kod</span>
                    <input type="text" class="doc-field w50" id="clientPostal" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Miejscowo≈õƒá</span>
                    <input type="text" class="doc-field w120" id="clientCity" placeholder="">
                </div>
                <div class="doc-row">
                    <span class="label">Tel</span>
                    <input type="text" class="doc-field w120" id="clientPhone" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Email</span>
                    <input type="text" class="doc-field w200" id="clientEmail" placeholder="">
                </div>
            </div>

            <!-- Adres dostawy -->
            <div class="doc-section">
                <div class="doc-section-title">Adres Dostawy / Monta≈ºu</div>
                <div class="doc-row">
                    <span class="label">Adres</span>
                    <input type="text" class="doc-field w200" id="deliveryAddress" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Kod</span>
                    <input type="text" class="doc-field w50" id="deliveryPostal" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Miejscowo≈õƒá</span>
                    <input type="text" class="doc-field w120" id="deliveryCity" placeholder="">
                </div>
                <div class="doc-row">
                    <span class="label">Nazwa projektu</span>
                    <input type="text" class="doc-field w200" id="projectName" placeholder="">
                    <span class="doc-sep">|</span>
                    <span class="label">Kontakt na miejscu</span>
                    <input type="text" class="doc-field w200" id="deliveryContact" placeholder="">
                </div>
            </div>

            <hr class="doc-hr">

            <!-- Przedmiot zam√≥wienia -->
            <div class="doc-section">
                <div class="doc-section-title">Przedmiot Zam√≥wienia</div>
                <table class="products-table" id="productsTable">
                    <thead>
                        <tr>
                            <th>Lp.</th>
                            <th class="col-name">Nazwa produktu</th>
                            <th class="col-desc">Opis / specyfikacja</th>
                            <th class="col-qty">Ilo≈õƒá</th>
                            <th class="col-unit">Jedn.</th>
                            <th class="col-price">Cena netto</th>
                            <th class="col-vat">VAT</th>
                            <th class="col-total">Warto≈õƒá netto</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Generowane dynamicznie -->
                    </tbody>
                </table>

                <!-- Podsumowanie -->
                <div class="totals-box">
                    <table class="totals-table">
                        <tr>
                            <td>Suma netto</td>
                            <td id="sumNetto">0,00 z≈Ç</td>
                        </tr>
                        <tr>
                            <td>VAT</td>
                            <td id="sumVat">0,00 z≈Ç</td>
                        </tr>
                        <tr>
                            <td>Razem brutto</td>
                            <td id="sumBrutto">0,00 z≈Ç</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Warunki realizacji -->
            <div class="doc-section">
                <div class="doc-section-title">Warunki Realizacji</div>
                <div class="terms-grid">
                    <div class="term-row">
                        <span class="label">Termin</span>
                        <input type="text" id="termRealization" placeholder="">
                    </div>
                    <div class="term-row">
                        <span class="label">P≈Çatno≈õƒá</span>
                        <select id="termPayment">
                            <option value="50% zaliczka, 50% przed dostawƒÖ">50% zaliczka, 50% przed dostawƒÖ</option>
                            <option value="100% zaliczka">100% zaliczka</option>
                            <option value="Przelew 14 dni">Przelew 14 dni</option>
                            <option value="Przelew 30 dni">Przelew 30 dni</option>
                            <option value="Got√≥wka przy odbiorze">Got√≥wka przy odbiorze</option>
                        </select>
                    </div>
                    <div class="term-row">
                        <span class="label">Dostawa</span>
                        <select id="termDelivery">
                            <option value="Transport firmowy">Transport firmowy</option>
                            <option value="Odbi√≥r w≈Çasny">Odbi√≥r w≈Çasny</option>
                            <option value="Kurier">Kurier</option>
                        </select>
                    </div>
                    <div class="term-row">
                        <span class="label">Monta≈º</span>
                        <select id="termAssembly">
                            <option value="W cenie">W cenie zam√≥wienia</option>
                            <option value="Dodatkowo p≈Çatny">Dodatkowo p≈Çatny</option>
                            <option value="Nie dotyczy">Nie dotyczy</option>
                        </select>
                    </div>
                    <div class="term-row">
                        <span class="label">Gwarancja</span>
                        <select id="termWarranty">
                            <option value="24 miesiƒÖce">24 miesiƒÖce</option>
                            <option value="36 miesiƒôcy">36 miesiƒôcy</option>
                            <option value="12 miesiƒôcy">12 miesiƒôcy</option>
                        </select>
                    </div>
                    <div class="term-row">
                        <span class="label">Zaliczka</span>
                        <input type="text" id="termAdvance" placeholder="">
                    </div>
                </div>
            </div>

            <!-- Uwagi -->
            <div class="doc-section">
                <div class="doc-section-title">Uwagi do Zam√≥wienia</div>
                <div class="doc-row">
                    <input type="text" class="doc-field w-full" id="remarks" placeholder="">
                </div>
            </div>

            <!-- O≈õwiadczenie zamawiajƒÖcego -->
            <div class="statement-box">
                <p><b>O≈õwiadczenie ZamawiajƒÖcego:</b> Potwierdzam przyjƒôcie zam√≥wienia zgodnie z powy≈ºszƒÖ specyfikacjƒÖ.</p>
                <div class="checkbox-row">
                    <input type="checkbox" id="acceptTerms">
                    <label for="acceptTerms">Akceptujƒô warunki realizacji zam√≥wienia oraz og√≥lne warunki wsp√≥≈Çpracy.</label>
                </div>
                <div class="checkbox-row">
                    <input type="checkbox" id="acceptData">
                    <label for="acceptData">Wyra≈ºam zgodƒô na przetwarzanie danych osobowych w celu realizacji zam√≥wienia.</label>
                </div>
            </div>

            <!-- Podpisy -->
            <div class="signatures-section">
                <div class="doc-section-title">Podpisy</div>
                <div class="signatures-grid">
                    <div class="signature-box">
                        <h4>ZamawiajƒÖcy</h4>
                        <div class="signature-row">
                            <label>Imiƒô i nazwisko</label>
                            <input type="text" id="clientSignName" placeholder="">
                        </div>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                        <div class="signature-row">
                            <label>Data</label>
                            <input type="text" id="clientSignDate" placeholder="">
                        </div>
                    </div>

                    <div class="signature-box">
                        <h4>Przedstawiciel WALABI</h4>
                        <div class="signature-row">
                            <label>Imiƒô i nazwisko</label>
                            <input type="text" id="walabiSignName" placeholder="">
                        </div>
                        <div class="signature-row">
                            <label>Podpis</label>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stopka -->
            <div class="doc-footer">
                WALABI Sp. z o.o. Sp.k. ¬∑ ul. Kosynier√≥w Ko≈õciuszkowskich 13/4 ¬∑ 87-100 Toru≈Ñ ¬∑ NIP: 8792700696
            </div>
        </div>
    </main>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
(function() {
    'use strict';

    const STORAGE_KEY = 'walabi_zamowienia';
    const CURRENT_KEY = 'walabi_zamowienie_current';
    let rowCount = 5;

    // ===== FORMAT NUMBER =====
    function formatNumber(num) {
        const fixed = num.toFixed(2);
        const parts = fixed.split('.');
        const intPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        return intPart + ',' + parts[1];
    }

    function formatCurrency(value) {
        return formatNumber(value) + ' z≈Ç';
    }

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded', function() {
        buildRows(5);
        setDefaultDate();
        setNextOrderNumber();
        renderHistory();

        // Auto-obliczanie przy ka≈ºdej zmianie w tabeli
        document.getElementById('productsTable').addEventListener('input', calculateTotals);

        // Sync client name to signature
        document.getElementById('clientName').addEventListener('input', function() {
            document.getElementById('clientSignName').value = this.value;
        });
    });

    // ===== WIERSZE TABELI =====
    function buildRows(count) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            tbody.appendChild(createRow(i));
        }
        rowCount = count;
    }

    function createRow(num) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${num}</td>
            <td><input type="text" id="prod${num}_name" placeholder=""></td>
            <td><input type="text" id="prod${num}_desc" placeholder=""></td>
            <td><input type="number" id="prod${num}_qty" min="0" step="1" value="1"></td>
            <td>
                <select id="prod${num}_unit">
                    <option value="szt.">szt.</option>
                    <option value="kpl.">kpl.</option>
                    <option value="mb">mb</option>
                    <option value="m¬≤">m¬≤</option>
                </select>
            </td>
            <td><input type="number" id="prod${num}_price" min="0" step="0.01" placeholder=""></td>
            <td>
                <select id="prod${num}_vat">
                    <option value="23">23%</option>
                    <option value="8">8%</option>
                    <option value="5">5%</option>
                    <option value="0">0%</option>
                </select>
            </td>
            <td class="line-total" id="lineTotal${num}">0,00 z≈Ç</td>`;
        return tr;
    }

    window.addRow = function() {
        rowCount++;
        const tbody = document.getElementById('tableBody');
        tbody.appendChild(createRow(rowCount));
        toast('Dodano pozycjƒô ' + rowCount);
    };

    window.removeRow = function() {
        if (rowCount <= 1) return;
        const tbody = document.getElementById('tableBody');
        tbody.removeChild(tbody.lastElementChild);
        rowCount--;
        calculateTotals();
        toast('Usuniƒôto pozycjƒô');
    };

    // ===== OBLICZENIA =====
    function calculateTotals() {
        let sumNetto = 0;
        let sumVat = 0;

        for (let i = 1; i <= rowCount; i++) {
            const qtyEl = document.getElementById(`prod${i}_qty`);
            const priceEl = document.getElementById(`prod${i}_price`);
            const vatEl = document.getElementById(`prod${i}_vat`);
            const totalEl = document.getElementById(`lineTotal${i}`);

            if (qtyEl && priceEl && vatEl && totalEl) {
                const qty = parseFloat(qtyEl.value) || 0;
                const price = parseFloat(priceEl.value) || 0;
                const vatRate = parseFloat(vatEl.value) || 23;

                const lineNetto = qty * price;
                const lineVat = lineNetto * (vatRate / 100);

                sumNetto += lineNetto;
                sumVat += lineVat;

                totalEl.textContent = formatCurrency(lineNetto);
            }
        }

        document.getElementById('sumNetto').textContent = formatCurrency(sumNetto);
        document.getElementById('sumVat').textContent = formatCurrency(sumVat);
        document.getElementById('sumBrutto').textContent = formatCurrency(sumNetto + sumVat);
    }

    // ===== DATA I NUMER =====
    function setDefaultDate() {
        const d = new Date();
        const str = String(d.getDate()).padStart(2,'0') + '.' + String(d.getMonth()+1).padStart(2,'0') + '.' + d.getFullYear();
        document.getElementById('orderDate').value = str;
        document.getElementById('clientSignDate').value = str;
    }

    function setNextOrderNumber() {
        const docs = loadAllDocs();
        const d = new Date();
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const nextNum = String(docs.length + 1).padStart(3, '0');
        document.getElementById('orderNumber').value = `ZAM/${year}/${month}/${nextNum}`;
    }

    // ===== SERIALIZACJA =====
    function collectFormData() {
        const data = { rowCount: rowCount, fields: {} };
        document.querySelectorAll('.document input, .document select').forEach(el => {
            if (!el.id) return;
            if (el.type === 'checkbox') {
                data.fields[el.id] = el.checked;
            } else {
                data.fields[el.id] = el.value;
            }
        });
        return data;
    }

    function restoreFormData(data) {
        if (data.rowCount) buildRows(data.rowCount);
        Object.keys(data.fields).forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            if (el.type === 'checkbox') {
                el.checked = data.fields[id];
            } else {
                el.value = data.fields[id];
            }
        });
        calculateTotals();
    }

    // ===== STORAGE =====
    function loadAllDocs() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        } catch { return []; }
    }

    function saveAllDocs(docs) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(docs));
    }

    window.saveDocument = function() {
        const data = collectFormData();
        const orderNr = document.getElementById('orderNumber').value || '??';
        const client = document.getElementById('clientName').value || 'Brak klienta';
        const date = document.getElementById('orderDate').value || '';

        const doc = {
            id: Date.now(),
            number: orderNr,
            client: client,
            date: date,
            data: data
        };

        const docs = loadAllDocs();
        const currentId = parseInt(localStorage.getItem(CURRENT_KEY));
        const existingIdx = docs.findIndex(d => d.id === currentId);
        if (existingIdx >= 0) {
            docs[existingIdx] = { ...docs[existingIdx], number: doc.number, client: doc.client, date: doc.date, data: doc.data };
        } else {
            docs.push(doc);
            localStorage.setItem(CURRENT_KEY, doc.id);
        }

        saveAllDocs(docs);
        renderHistory();
        toast('Dokument zapisany', 'success');
    };

    window.loadDocument = function(id) {
        const docs = loadAllDocs();
        const doc = docs.find(d => d.id === id);
        if (!doc) return;
        restoreFormData(doc.data);
        localStorage.setItem(CURRENT_KEY, id);
        toast('Wczytano: ' + doc.number);
    };

    window.deleteDocument = function(id, e) {
        e.stopPropagation();
        if (!confirm('UsunƒÖƒá ten dokument z historii?')) return;
        let docs = loadAllDocs();
        docs = docs.filter(d => d.id !== id);
        saveAllDocs(docs);
        renderHistory();
        toast('Dokument usuniƒôty');
    };

    // ===== HISTORIA =====
    function renderHistory() {
        const docs = loadAllDocs();
        const container = document.getElementById('historyList');

        if (!docs.length) {
            container.innerHTML = '<div class="history-empty">Brak zapisanych dokument√≥w</div>';
            return;
        }

        container.innerHTML = docs.map(doc => `
            <div class="history-item" onclick="loadDocument(${doc.id})">
                <div>
                    <div class="hi-number">${doc.number}</div>
                    <div class="hi-client">${doc.client} | ${doc.date}</div>
                </div>
                <button class="hi-delete" onclick="deleteDocument(${doc.id}, event)" title="Usu≈Ñ">&times;</button>
            </div>
        `).reverse().join('');
    }

    // ===== AKCJE =====
    window.newDocument = function() {
        if (!confirm('RozpoczƒÖƒá nowy dokument? Niezapisane dane zostanƒÖ utracone.')) return;
        buildRows(5);
        document.querySelectorAll('.document input, .document select').forEach(el => {
            if (el.type === 'checkbox') {
                el.checked = false;
            } else if (el.tagName === 'SELECT') {
                el.selectedIndex = 0;
            } else {
                el.value = '';
            }
        });
        localStorage.removeItem(CURRENT_KEY);
        setDefaultDate();
        setNextOrderNumber();
        calculateTotals();
        toast('Nowy dokument');
    };

    window.clearForm = function() {
        if (!confirm('Wyczy≈õciƒá wszystkie pola formularza?')) return;
        document.querySelectorAll('.document input, .document select').forEach(el => {
            if (el.type === 'checkbox') {
                el.checked = false;
            } else if (el.tagName === 'SELECT') {
                el.selectedIndex = 0;
            } else {
                el.value = '';
            }
        });
        setDefaultDate();
        calculateTotals();
        toast('Formularz wyczyszczony');
    };

    window.printDoc = function() {
        window.print();
    };

    window.sendEmail = function() {
        const docNum = document.getElementById('orderNumber').value || 'Zam√≥wienie';
        const client = document.getElementById('clientName').value || '';
        const subject = encodeURIComponent(`WALABI - ${docNum}${client ? ' - ' + client : ''}`);
        const body = encodeURIComponent(`Dzie≈Ñ dobry,\n\nW za≈ÇƒÖczeniu przesy≈Çam ${docNum}.\n\nZ powa≈ºaniem,\nWALABI Sp. z o.o. Sp.k.`);
        window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
        toast('Otwarto klienta email');
    };

    window.sendWhatsApp = function() {
        const docNum = document.getElementById('orderNumber').value || 'Zam√≥wienie';
        const client = document.getElementById('clientName').value || '';
        const text = encodeURIComponent(`Dzie≈Ñ dobry,\n\nW za≈ÇƒÖczeniu przesy≈Çam ${docNum}${client ? ' dla ' + client : ''} z WALABI.`);
        window.open(`https://wa.me/?text=${text}`, '_blank');
        toast('Otwarto WhatsApp');
    };

    // ===== TOAST =====
    function toast(msg, type) {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.className = 'toast show ' + (type || '');
        clearTimeout(el._timer);
        el._timer = setTimeout(() => { el.className = 'toast'; }, 2500);
    }

    // ===== EKSPORT/IMPORT JSON =====
    window.collectFormData = function() {
        const data = {};
        document.querySelectorAll('.document input, .document textarea, .document select').forEach(el => {
            if (el.id) data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
        });
        return data;
    };

    window.restoreFormData = function(data) {
        Object.keys(data).forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                if (el.type === 'checkbox') el.checked = data[id];
                else el.value = data[id];
            }
        });
        calculateTotals();
    };

    window.exportToJSON = function() {
        const data = collectFormData();
        const docNum = document.getElementById('docNumber')?.value || 'zamowienie';
        const client = document.getElementById('clientName')?.value || 'klient';

        const exportData = {
            type: 'zamowienie',
            version: '1.0',
            exportDate: new Date().toISOString(),
            docNumber: docNum,
            client: client,
            formData: data
        };

        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${docNum.replace(/\//g, '-')}_${client.replace(/\s+/g, '_')}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        toast('Dane wyeksportowane', 'success');
    };

    window.importFromJSON = function(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importData = JSON.parse(e.target.result);
                if (importData.formData) {
                    restoreFormData(importData.formData);
                    toast('Dane zaimportowane', 'success');
                } else {
                    toast('Nieprawid≈Çowy format', 'error');
                }
            } catch (err) {
                toast('B≈ÇƒÖd wczytywania', 'error');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    };

})();
</script>
<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fpConfig = {
            locale: 'pl',
            dateFormat: 'd.m.Y',
            allowInput: true,
            disableMobile: false
        };

        flatpickr('#orderDate', fpConfig);
        flatpickr('#termRealization', fpConfig);
        flatpickr('#clientSignDate', fpConfig);
    });
</script>
</body>
</html>
